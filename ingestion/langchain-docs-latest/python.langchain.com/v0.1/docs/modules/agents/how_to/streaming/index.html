<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-modules/agents/how_to/streaming" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">Streaming | ü¶úÔ∏èüîó LangChain</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://python.langchain.com/v0.1/img/brand/theme-image.png"><meta data-rh="true" name="twitter:image" content="https://python.langchain.com/v0.1/img/brand/theme-image.png"><meta data-rh="true" property="og:url" content="https://python.langchain.com/docs/how_to/migrate_agent/"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Streaming | ü¶úÔ∏èüîó LangChain"><meta data-rh="true" name="description" content="Streaming is an important UX consideration for LLM apps, and agents are no exception. Streaming with agents is made more complicated by the fact that it&#x27;s not just tokens of the final answer that you will want to stream, but you may also want to stream back the intermediate steps an agent takes."><meta data-rh="true" property="og:description" content="Streaming is an important UX consideration for LLM apps, and agents are no exception. Streaming with agents is made more complicated by the fact that it&#x27;s not just tokens of the final answer that you will want to stream, but you may also want to stream back the intermediate steps an agent takes."><link data-rh="true" rel="icon" href="/v0.1/img/brand/favicon.png"><link data-rh="true" rel="canonical" href="https://python.langchain.com/docs/how_to/migrate_agent/"><link data-rh="true" rel="alternate" href="https://python.langchain.com/v0.1/docs/modules/agents/how_to/streaming/" hreflang="en"><link data-rh="true" rel="alternate" href="https://python.langchain.com/v0.1/docs/modules/agents/how_to/streaming/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://VAU016LAWS-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="ü¶úÔ∏èüîó LangChain" href="/v0.1/opensearch.xml">


<script src="/v0.1/js/google_analytics.js"></script>
<script src="https://www.googletagmanager.com/gtag/js?id=G-9B66JQQH2F" async></script><link rel="stylesheet" href="/v0.1/assets/css/styles.d4021fd6.css">
<link rel="preload" href="/v0.1/assets/js/runtime~main.1cd6ff7f.js" as="script">
<link rel="preload" href="/v0.1/assets/js/main.524fe94c.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:#FF0000;color:#FFFFFF" role="banner"><div class="content_knG7 announcementBarContent_xLdY">This is documentation for LangChain v0.1, which is no longer actively maintained. Check out the docs for the <a href="https://python.langchain.com/docs/introduction">latest version here</a>.</div></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/v0.1/"><div class="navbar__logo"><img src="/v0.1/img/brand/wordmark.png" alt="ü¶úÔ∏èüîó LangChain" class="themedImage_ToTc themedImage--light_HNdA"><img src="/v0.1/img/brand/wordmark-dark.png" alt="ü¶úÔ∏èüîó LangChain" class="themedImage_ToTc themedImage--dark_i4oU"></div></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/v0.1/docs/modules/">Components</a><a class="navbar__item navbar__link" href="/v0.1/docs/integrations/platforms/">Integrations</a><a class="navbar__item navbar__link" href="/v0.1/docs/guides/">Guides</a><a href="https://api.python.langchain.com/en/v0.1/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">API Reference<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">More</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/v0.1/docs/people/">People</a></li><li><a class="dropdown__link" href="/v0.1/docs/packages/">Versioning</a></li><li><a class="dropdown__link" href="/v0.1/docs/contributing/">Contributing</a></li><li><a class="dropdown__link" href="/v0.1/docs/templates/">Templates</a></li><li><a href="https://github.com/langchain-ai/langchain/blob/master/cookbook/README.md" target="_blank" rel="noopener noreferrer" class="dropdown__link">Cookbooks<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a class="dropdown__link" href="/v0.1/docs/additional_resources/tutorials/">Tutorials</a></li><li><a class="dropdown__link" href="/v0.1/docs/additional_resources/youtube/">YouTube</a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">v0.1</a><ul class="dropdown__menu"><li><a href="https://python.langchain.com/docs/introduction" target="_blank" rel="noopener noreferrer" class="dropdown__link">Latest<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://python.langchain.com/v0.2/docs/introduction" target="_blank" rel="noopener noreferrer" class="dropdown__link">v0.2<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a class="dropdown__link" href="/v0.1/docs/get_started/introduction/">v0.1</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">ü¶úÔ∏èüîó</a><ul class="dropdown__menu"><li><a href="https://smith.langchain.com" target="_blank" rel="noopener noreferrer" class="dropdown__link">LangSmith<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://docs.smith.langchain.com/" target="_blank" rel="noopener noreferrer" class="dropdown__link">LangSmith Docs<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://github.com/langchain-ai/langserve" target="_blank" rel="noopener noreferrer" class="dropdown__link">LangServe GitHub<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://github.com/langchain-ai/langchain/tree/master/templates" target="_blank" rel="noopener noreferrer" class="dropdown__link">Templates GitHub<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://templates.langchain.com" target="_blank" rel="noopener noreferrer" class="dropdown__link">Templates Hub<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://smith.langchain.com/hub" target="_blank" rel="noopener noreferrer" class="dropdown__link">LangChain Hub<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://js.langchain.com" target="_blank" rel="noopener noreferrer" class="dropdown__link">JS/TS Docs<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><a href="https://chat.langchain.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">üí¨<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/langchain-ai/langchain" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link" href="/v0.1/docs/modules/model_io/">Model I/O</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/v0.1/docs/modules/model_io/prompts/">Prompts</a><button aria-label="Toggle the collapsible sidebar category &#x27;Prompts&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/v0.1/docs/modules/model_io/chat/">Chat models</a><button aria-label="Toggle the collapsible sidebar category &#x27;Chat models&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/v0.1/docs/modules/model_io/llms/">LLMs</a><button aria-label="Toggle the collapsible sidebar category &#x27;LLMs&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/v0.1/docs/modules/model_io/output_parsers/">Output parsers</a><button aria-label="Toggle the collapsible sidebar category &#x27;Output parsers&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link" href="/v0.1/docs/modules/data_connection/">Retrieval</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/v0.1/docs/modules/data_connection/document_loaders/">Document loaders</a><button aria-label="Toggle the collapsible sidebar category &#x27;Document loaders&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/v0.1/docs/modules/data_connection/document_transformers/">Text splitters</a><button aria-label="Toggle the collapsible sidebar category &#x27;Text splitters&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/v0.1/docs/modules/data_connection/text_embedding/">Embedding models</a><button aria-label="Toggle the collapsible sidebar category &#x27;Embedding models&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/v0.1/docs/modules/data_connection/vectorstores/">Vector stores</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/v0.1/docs/modules/data_connection/retrievers/">Retrievers</a><button aria-label="Toggle the collapsible sidebar category &#x27;Retrievers&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/v0.1/docs/modules/data_connection/indexing/">Indexing</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active" href="/v0.1/docs/modules/composition/">Composition</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/v0.1/docs/modules/tools/">Tools</a><button aria-label="Toggle the collapsible sidebar category &#x27;Tools&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/v0.1/docs/modules/agents/">Agents</a><button aria-label="Toggle the collapsible sidebar category &#x27;Agents&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/v0.1/docs/modules/agents/quick_start/">Quickstart</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/v0.1/docs/modules/agents/concepts/">Concepts</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/v0.1/docs/modules/agents/agent_types/">Types</a><button aria-label="Toggle the collapsible sidebar category &#x27;Types&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/v0.1/docs/modules/agents/">Agents</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/v0.1/docs/modules/agents/how_to/custom_agent/">how_to</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/v0.1/docs/modules/agents/how_to/custom_agent/">Custom agent</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/v0.1/docs/modules/agents/how_to/streaming/">Streaming</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/v0.1/docs/modules/agents/how_to/agent_iter/">Running Agent as an Iterator</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/v0.1/docs/modules/agents/how_to/agent_structured/">Returning Structured Output</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/v0.1/docs/modules/agents/how_to/handle_parsing_errors/">Handle parsing errors</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/v0.1/docs/modules/agents/how_to/intermediate_steps/">Access intermediate steps</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/v0.1/docs/modules/agents/how_to/max_iterations/">Cap the max number of iterations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/v0.1/docs/modules/agents/how_to/max_time_limit/">Timeouts for agents</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/v0.1/docs/modules/chains/">Chains</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/v0.1/docs/modules/memory/">More</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item hidden"><a class="menu__link" href="/v0.1/docs/modules/">Components</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for <!-- -->LangChain<!-- --> <b>v0.1</b>, which is no longer actively maintained.</div><div class="margin-top--md">For the current stable version, see <b><a href="https://python.langchain.com/docs/how_to/migrate_agent/" target="_blank" rel="noopener noreferrer">this version</a></b> (<!-- -->Latest<!-- -->).</div></div><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/v0.1/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/v0.1/docs/modules/composition/"><span itemprop="name">Composition</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/v0.1/docs/modules/agents/"><span itemprop="name">Agents</span></a><meta itemprop="position" content="2"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">how_to</span><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Streaming</span><meta itemprop="position" content="4"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Streaming</h1><p>Streaming is an important UX consideration for LLM apps, and agents are no exception. Streaming with agents is made more complicated by the fact that it&#x27;s not just tokens of the final answer that you will want to stream, but you may also want to stream back the intermediate steps an agent takes.</p><p>In this notebook, we&#x27;ll cover the <code>stream/astream</code> and <code>astream_events</code> for streaming.</p><p>Our agent will use a tools API for tool invocation with the tools:</p><ol><li><code>where_cat_is_hiding</code>:  Returns a location where the cat is hiding</li><li><code>get_items</code>: Lists items that can be found in a particular place</li></ol><p>These tools will allow us to explore streaming in a more interesting situation where the agent will have to use both tools to answer some questions (e.g., to answer the question <code>what items are located where the cat is hiding?</code>).</p><p>Ready?üèéÔ∏è</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">from</span><span class="token plain"> langchain </span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> hub</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">from</span><span class="token plain"> langchain</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">agents </span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> AgentExecutor</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> create_openai_tools_agent</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">from</span><span class="token plain"> langchain</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">tools </span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> tool</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">from</span><span class="token plain"> langchain_core</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">callbacks </span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> Callbacks</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">from</span><span class="token plain"> langchain_core</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">prompts </span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> ChatPromptTemplate</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">from</span><span class="token plain"> langchain_openai </span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> ChatOpenAI</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div style="padding-top:1.3rem;background:var(--prism-background-color);color:var(--prism-color);margin-top:calc(-1 * var(--ifm-leading) - 5px);margin-bottom:var(--ifm-leading);box-shadow:var(--ifm-global-shadow-lw);border-bottom-left-radius:var(--ifm-code-border-radius);border-bottom-right-radius:var(--ifm-code-border-radius)"><h4 style="padding-left:0.65rem;margin-bottom:0.45rem">API Reference:</h4><ul style="padding-bottom:1rem"><li><a href="https://api.python.langchain.com/en/latest/agents/langchain.agents.agent.AgentExecutor.html"><span>AgentExecutor</span></a></li><li><a href="https://api.python.langchain.com/en/latest/agents/langchain.agents.openai_tools.base.create_openai_tools_agent.html"><span>create_openai_tools_agent</span></a></li><li><a href="https://api.python.langchain.com/en/latest/tools/langchain_core.tools.tool.html"><span>tool</span></a></li><li><a href="https://api.python.langchain.com/en/latest/prompts/langchain_core.prompts.chat.ChatPromptTemplate.html"><span>ChatPromptTemplate</span></a></li><li><a href="https://api.python.langchain.com/en/latest/chat_models/langchain_openai.chat_models.base.ChatOpenAI.html"><span>ChatOpenAI</span></a></li></ul></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="create-the-model">Create the model<a href="#create-the-model" class="hash-link" aria-label="Direct link to Create the model" title="Direct link to Create the model">‚Äã</a></h2><p><strong>Attention</strong> We&#x27;re setting <code>streaming=True</code> on the LLM. This will allow us to stream tokens from the agent using the <code>astream_events</code> API. This is needed for older versions of LangChain.</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">model </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> ChatOpenAI</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">temperature</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> streaming</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token boolean">True</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="tools">Tools<a href="#tools" class="hash-link" aria-label="Direct link to Tools" title="Direct link to Tools">‚Äã</a></h2><p>We define two tools that rely on a chat model to generate output!</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> random</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:rgb(4, 81, 165)">@tool</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">async</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">where_cat_is_hiding</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(0, 112, 193)">str</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:rgb(163, 21, 21)">&quot;&quot;&quot;Where is the cat hiding right now?&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> random</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">choice</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;under the bed&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;on the shelf&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:rgb(4, 81, 165)">@tool</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">async</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">get_items</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">place</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(0, 112, 193)">str</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(0, 112, 193)">str</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:rgb(163, 21, 21)">&quot;&quot;&quot;Use this tool to look up which items are in the given place.&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;bed&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> place</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># For under the bed</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;socks, shoes and dust bunnies&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;shelf&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> place</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># For &#x27;shelf&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;books, penciles and pictures&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">else</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># if the agent decides to ask about a different place</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;cat snacks&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">await</span><span class="token plain"> where_cat_is_hiding</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">ainvoke</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-output codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-output codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">&#x27;on the shelf&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">await</span><span class="token plain"> get_items</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">ainvoke</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;place&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;shelf&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-output codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-output codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">&#x27;books, penciles and pictures&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="initialize-the-agent">Initialize the agent<a href="#initialize-the-agent" class="hash-link" aria-label="Direct link to Initialize the agent" title="Direct link to Initialize the agent">‚Äã</a></h2><p>Here, we&#x27;ll initialize an OpenAI tools agent.</p><p><strong>ATTENTION</strong> Please note that we associated the name <code>Agent</code> with our agent using <code>&quot;run_name&quot;=&quot;Agent&quot;</code>. We&#x27;ll use that fact later on with the <code>astream_events</code> API.</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># Get the prompt to use - you can modify this!</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">prompt </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> hub</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">pull</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;hwchase17/openai-tools-agent&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># print(prompt.messages) -- to see the prompt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">tools </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">get_items</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> where_cat_is_hiding</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">agent </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> create_openai_tools_agent</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    model</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">with_config</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;tags&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;agent_llm&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> tools</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> prompt</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">agent_executor </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> AgentExecutor</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">agent</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">agent</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> tools</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">tools</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">with_config</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;run_name&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Agent&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="stream-intermediate-steps">Stream Intermediate Steps<a href="#stream-intermediate-steps" class="hash-link" aria-label="Direct link to Stream Intermediate Steps" title="Direct link to Stream Intermediate Steps">‚Äã</a></h2><p>We&#x27;ll use <code>.stream</code> method of the AgentExecutor to stream the agent&#x27;s intermediate steps.</p><p>The output from <code>.stream</code> alternates between (action, observation) pairs, finally concluding with the answer if the agent achieved its objective. </p><p>It&#x27;ll look like this:</p><ol><li>actions output</li><li>observations output</li><li>actions output</li><li>observations output</li></ol><p><strong>... (continue until goal is reached) ...</strong></p><p>Then, if the final goal is reached, the agent will output the <strong>final answer</strong>.</p><p>The contents of these outputs are summarized here:</p><table><thead><tr><th>Output</th><th>Contents</th></tr></thead><tbody><tr><td><strong>Actions</strong></td><td><code>actions</code> <code>AgentAction</code> or a subclass, <code>messages</code> chat messages corresponding to action invocation</td></tr><tr><td><strong>Observations</strong></td><td><code>steps</code> History of what the agent did so far, including the current action and its observation, <code>messages</code> chat message with function invocation results (aka observations)</td></tr><tr><td><strong>Final answer</strong></td><td><code>output</code> <code>AgentFinish</code>, <code>messages</code> chat messages with the final output</td></tr></tbody></table><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># Note: We use `pprint` to print only to depth 1, it makes it easier to see the output from a high level, before digging in.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> pprint</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">chunks </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">async</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> chunk </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> agent_executor</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">astream</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;input&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;what&#x27;s items are located where the cat is hiding?&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    chunks</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">append</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">chunk</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;------&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    pprint</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">pprint</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">chunk</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> depth</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-output codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-output codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">------</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;actions&#x27;: [...], &#x27;messages&#x27;: [...]}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">------</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;messages&#x27;: [...], &#x27;steps&#x27;: [...]}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">------</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;actions&#x27;: [...], &#x27;messages&#x27;: [...]}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">------</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;messages&#x27;: [...], &#x27;steps&#x27;: [...]}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">------</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;messages&#x27;: [...],</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> &#x27;output&#x27;: &#x27;The items located where the cat is hiding on the shelf are books, &#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">           &#x27;pencils, and pictures.&#x27;}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="using-messages">Using Messages<a href="#using-messages" class="hash-link" aria-label="Direct link to Using Messages" title="Direct link to Using Messages">‚Äã</a></h3><p>You can access the underlying <code>messages</code> from the outputs. Using messages can be nice when working with chat applications - because everything is a message!</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">chunks</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;actions&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-output codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-output codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">[OpenAIToolAgentAction(tool=&#x27;where_cat_is_hiding&#x27;, tool_input={}, log=&#x27;\nInvoking: `where_cat_is_hiding` with `{}`\n\n\n&#x27;, message_log=[AIMessageChunk(content=&#x27;&#x27;, additional_kwargs={&#x27;tool_calls&#x27;: [{&#x27;index&#x27;: 0, &#x27;id&#x27;: &#x27;call_pKy4OLcBx6pR6k3GHBOlH68r&#x27;, &#x27;function&#x27;: {&#x27;arguments&#x27;: &#x27;{}&#x27;, &#x27;name&#x27;: &#x27;where_cat_is_hiding&#x27;}, &#x27;type&#x27;: &#x27;function&#x27;}]})], tool_call_id=&#x27;call_pKy4OLcBx6pR6k3GHBOlH68r&#x27;)]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> chunk </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> chunks</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">chunk</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;messages&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-output codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-output codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">[AIMessageChunk(content=&#x27;&#x27;, additional_kwargs={&#x27;tool_calls&#x27;: [{&#x27;index&#x27;: 0, &#x27;id&#x27;: &#x27;call_pKy4OLcBx6pR6k3GHBOlH68r&#x27;, &#x27;function&#x27;: {&#x27;arguments&#x27;: &#x27;{}&#x27;, &#x27;name&#x27;: &#x27;where_cat_is_hiding&#x27;}, &#x27;type&#x27;: &#x27;function&#x27;}]})]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">[FunctionMessage(content=&#x27;on the shelf&#x27;, name=&#x27;where_cat_is_hiding&#x27;)]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">[AIMessageChunk(content=&#x27;&#x27;, additional_kwargs={&#x27;tool_calls&#x27;: [{&#x27;index&#x27;: 0, &#x27;id&#x27;: &#x27;call_qZTz1mRfCCXT18SUy0E07eS4&#x27;, &#x27;function&#x27;: {&#x27;arguments&#x27;: &#x27;{\n  &quot;place&quot;: &quot;shelf&quot;\n}&#x27;, &#x27;name&#x27;: &#x27;get_items&#x27;}, &#x27;type&#x27;: &#x27;function&#x27;}]})]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">[FunctionMessage(content=&#x27;books, penciles and pictures&#x27;, name=&#x27;get_items&#x27;)]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">[AIMessage(content=&#x27;The items located where the cat is hiding on the shelf are books, pencils, and pictures.&#x27;)]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In addition, they contain full logging information (<code>actions</code> and <code>steps</code>) which may be easier to process for rendering purposes.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="using-agentactionobservation">Using AgentAction/Observation<a href="#using-agentactionobservation" class="hash-link" aria-label="Direct link to Using AgentAction/Observation" title="Direct link to Using AgentAction/Observation">‚Äã</a></h3><p>The outputs also contain richer structured information inside of <code>actions</code> and <code>steps</code>, which could be useful in some situations, but can also be harder to parse.</p><p><strong>Attention</strong> <code>AgentFinish</code> is not available as part of the <code>streaming</code> method. If this is something you&#x27;d like to be added, please start a discussion on github and explain why its needed.</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">async</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> chunk </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> agent_executor</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">astream</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;input&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;what&#x27;s items are located where the cat is hiding?&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)"># Agent Action</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;actions&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> chunk</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> action </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> chunk</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;actions&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token keyword" style="color:rgb(0, 0, 255)">print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string-interpolation string" style="color:rgb(163, 21, 21)">f&quot;Calling Tool: `</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string-interpolation interpolation">action</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token string-interpolation interpolation">tool</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token string-interpolation string" style="color:rgb(163, 21, 21)">` with input `</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string-interpolation interpolation">action</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token string-interpolation interpolation">tool_input</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token string-interpolation string" style="color:rgb(163, 21, 21)">`&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)"># Observation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">elif</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;steps&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> chunk</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> step </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> chunk</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;steps&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token keyword" style="color:rgb(0, 0, 255)">print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string-interpolation string" style="color:rgb(163, 21, 21)">f&quot;Tool Result: `</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string-interpolation interpolation">step</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token string-interpolation interpolation">observation</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token string-interpolation string" style="color:rgb(163, 21, 21)">`&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)"># Final result</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">elif</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;output&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> chunk</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string-interpolation string" style="color:rgb(163, 21, 21)">f&#x27;Final Output: </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string-interpolation interpolation">chunk</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string-interpolation interpolation string" style="color:rgb(163, 21, 21)">&quot;output&quot;</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token string-interpolation string" style="color:rgb(163, 21, 21)">&#x27;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">else</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">raise</span><span class="token plain"> ValueError</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;---&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-output codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-output codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">Calling Tool: `where_cat_is_hiding` with input `{}`</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">---</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Tool Result: `on the shelf`</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">---</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Calling Tool: `get_items` with input `{&#x27;place&#x27;: &#x27;shelf&#x27;}`</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">---</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Tool Result: `books, penciles and pictures`</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">---</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Final Output: The items located where the cat is hiding on the shelf are books, pencils, and pictures.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">---</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="custom-streaming-with-events">Custom Streaming With Events<a href="#custom-streaming-with-events" class="hash-link" aria-label="Direct link to Custom Streaming With Events" title="Direct link to Custom Streaming With Events">‚Äã</a></h2><p>Use the <code>astream_events</code> API in case the default behavior of <em>stream</em> does not work for your application (e.g., if you need to stream individual tokens from the agent or surface steps occurring <strong>within</strong> tools).</p><p>‚ö†Ô∏è This is a <strong>beta</strong> API, meaning that some details might change slightly in the future based on usage.
‚ö†Ô∏è To make sure all callbacks work properly, use <code>async</code> code throughout. Try avoiding mixing in sync versions of code (e.g., sync versions of tools).</p><p>Let&#x27;s use this API to stream the following events:</p><ol><li>Agent Start with inputs</li><li>Tool Start with inputs</li><li>Tool End with outputs</li><li>Stream the agent final anwer token by token</li><li>Agent End with outputs</li></ol><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">async</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> event </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> agent_executor</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">astream_events</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;input&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;where is the cat hiding? what items are in that location?&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    version</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;v1&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    kind </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> event</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;event&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> kind </span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;on_chain_start&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            event</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;name&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Agent&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># Was assigned when creating the agent with `.with_config({&quot;run_name&quot;: &quot;Agent&quot;})`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token keyword" style="color:rgb(0, 0, 255)">print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                </span><span class="token string-interpolation string" style="color:rgb(163, 21, 21)">f&quot;Starting agent: </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string-interpolation interpolation">event</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string-interpolation interpolation string" style="color:rgb(163, 21, 21)">&#x27;name&#x27;</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token string-interpolation string" style="color:rgb(163, 21, 21)"> with input: </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string-interpolation interpolation">event</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string-interpolation interpolation string" style="color:rgb(163, 21, 21)">&#x27;data&#x27;</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token string-interpolation interpolation">get</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string-interpolation interpolation string" style="color:rgb(163, 21, 21)">&#x27;input&#x27;</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token string-interpolation string" style="color:rgb(163, 21, 21)">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">elif</span><span class="token plain"> kind </span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;on_chain_end&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            event</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;name&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Agent&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># Was assigned when creating the agent with `.with_config({&quot;run_name&quot;: &quot;Agent&quot;})`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token keyword" style="color:rgb(0, 0, 255)">print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token keyword" style="color:rgb(0, 0, 255)">print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;--&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token keyword" style="color:rgb(0, 0, 255)">print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                </span><span class="token string-interpolation string" style="color:rgb(163, 21, 21)">f&quot;Done agent: </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string-interpolation interpolation">event</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string-interpolation interpolation string" style="color:rgb(163, 21, 21)">&#x27;name&#x27;</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token string-interpolation string" style="color:rgb(163, 21, 21)"> with output: </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string-interpolation interpolation">event</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string-interpolation interpolation string" style="color:rgb(163, 21, 21)">&#x27;data&#x27;</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token string-interpolation interpolation">get</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string-interpolation interpolation string" style="color:rgb(163, 21, 21)">&#x27;output&#x27;</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string-interpolation interpolation string" style="color:rgb(163, 21, 21)">&#x27;output&#x27;</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token string-interpolation string" style="color:rgb(163, 21, 21)">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> kind </span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;on_chat_model_stream&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        content </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> event</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;data&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;chunk&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">content</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> content</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token comment" style="color:rgb(0, 128, 0)"># Empty content in the context of OpenAI means</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token comment" style="color:rgb(0, 128, 0)"># that the model is asking for a tool to be invoked.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token comment" style="color:rgb(0, 128, 0)"># So we only print non-empty content</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token keyword" style="color:rgb(0, 0, 255)">print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">content</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> end</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;|&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">elif</span><span class="token plain"> kind </span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;on_tool_start&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;--&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token string-interpolation string" style="color:rgb(163, 21, 21)">f&quot;Starting tool: </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string-interpolation interpolation">event</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string-interpolation interpolation string" style="color:rgb(163, 21, 21)">&#x27;name&#x27;</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token string-interpolation string" style="color:rgb(163, 21, 21)"> with inputs: </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string-interpolation interpolation">event</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string-interpolation interpolation string" style="color:rgb(163, 21, 21)">&#x27;data&#x27;</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token string-interpolation interpolation">get</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string-interpolation interpolation string" style="color:rgb(163, 21, 21)">&#x27;input&#x27;</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token string-interpolation string" style="color:rgb(163, 21, 21)">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">elif</span><span class="token plain"> kind </span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;on_tool_end&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string-interpolation string" style="color:rgb(163, 21, 21)">f&quot;Done tool: </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string-interpolation interpolation">event</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string-interpolation interpolation string" style="color:rgb(163, 21, 21)">&#x27;name&#x27;</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token string-interpolation string" style="color:rgb(163, 21, 21)">&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string-interpolation string" style="color:rgb(163, 21, 21)">f&quot;Tool output was: </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string-interpolation interpolation">event</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string-interpolation interpolation string" style="color:rgb(163, 21, 21)">&#x27;data&#x27;</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token string-interpolation interpolation">get</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string-interpolation interpolation string" style="color:rgb(163, 21, 21)">&#x27;output&#x27;</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token string-interpolation string" style="color:rgb(163, 21, 21)">&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;--&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-output codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-output codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">Starting agent: Agent with input: {&#x27;input&#x27;: &#x27;where is the cat hiding? what items are in that location?&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Starting tool: where_cat_is_hiding with inputs: {}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Done tool: where_cat_is_hiding</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Tool output was: on the shelf</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Starting tool: get_items with inputs: {&#x27;place&#x27;: &#x27;shelf&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Done tool: get_items</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Tool output was: books, penciles and pictures</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">The| cat| is| currently| hiding| on| the| shelf|.| In| that| location|,| you| can| find| books|,| pencils|,| and| pictures|.|</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Done agent: Agent with output: The cat is currently hiding on the shelf. In that location, you can find books, pencils, and pictures.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="stream-events-from-within-tools">Stream Events from within Tools<a href="#stream-events-from-within-tools" class="hash-link" aria-label="Direct link to Stream Events from within Tools" title="Direct link to Stream Events from within Tools">‚Äã</a></h3><p>If your tool leverages LangChain runnable objects (e.g., LCEL chains, LLMs, retrievers etc.) and you want to stream events from those objects as well, you&#x27;ll need to make sure that callbacks are propagated correctly.</p><p>To see how to pass callbacks, let&#x27;s re-implement the <code>get_items</code> tool to make it use an LLM and pass callbacks to that LLM. Feel free to adapt this to your use case.</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token decorator annotation punctuation" style="color:rgb(4, 81, 165)">@tool</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">async</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">get_items</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">place</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(0, 112, 193)">str</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> callbacks</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Callbacks</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(0, 112, 193)">str</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># &lt;--- Accept callbacks</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:rgb(163, 21, 21)">&quot;&quot;&quot;Use this tool to look up which items are in the given place.&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    template </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> ChatPromptTemplate</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">from_messages</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;human&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Can you tell me what kind of items i might find in the following place: &#x27;{place}&#x27;. &quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;List at least 3 such items separating them by a comma. And include a brief description of each item..&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    chain </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> template </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> model</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">with_config</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;run_name&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Get Items LLM&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;tags&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;tool_llm&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;callbacks&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> callbacks</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># &lt;-- Propagate callbacks</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    chunks </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">chunk </span><span class="token keyword" style="color:rgb(0, 0, 255)">async</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> chunk </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> chain</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">astream</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;place&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> place</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">join</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">chunk</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">content </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> chunk </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> chunks</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>^ Take a look at how the tool propagates callbacks. </p><p>Next, let&#x27;s initialize our agent, and take a look at the new output.</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># Get the prompt to use - you can modify this!</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">prompt </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> hub</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">pull</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;hwchase17/openai-tools-agent&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># print(prompt.messages) -- to see the prompt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">tools </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">get_items</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> where_cat_is_hiding</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">agent </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> create_openai_tools_agent</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    model</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">with_config</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;tags&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;agent_llm&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> tools</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> prompt</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">agent_executor </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> AgentExecutor</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">agent</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">agent</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> tools</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">tools</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">with_config</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;run_name&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Agent&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">async</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> event </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> agent_executor</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">astream_events</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;input&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;where is the cat hiding? what items are in that location?&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    version</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;v1&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    kind </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> event</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;event&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> kind </span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;on_chain_start&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            event</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;name&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Agent&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># Was assigned when creating the agent with `.with_config({&quot;run_name&quot;: &quot;Agent&quot;})`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token keyword" style="color:rgb(0, 0, 255)">print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                </span><span class="token string-interpolation string" style="color:rgb(163, 21, 21)">f&quot;Starting agent: </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string-interpolation interpolation">event</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string-interpolation interpolation string" style="color:rgb(163, 21, 21)">&#x27;name&#x27;</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token string-interpolation string" style="color:rgb(163, 21, 21)"> with input: </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string-interpolation interpolation">event</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string-interpolation interpolation string" style="color:rgb(163, 21, 21)">&#x27;data&#x27;</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token string-interpolation interpolation">get</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string-interpolation interpolation string" style="color:rgb(163, 21, 21)">&#x27;input&#x27;</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token string-interpolation string" style="color:rgb(163, 21, 21)">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">elif</span><span class="token plain"> kind </span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;on_chain_end&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            event</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;name&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Agent&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># Was assigned when creating the agent with `.with_config({&quot;run_name&quot;: &quot;Agent&quot;})`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token keyword" style="color:rgb(0, 0, 255)">print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token keyword" style="color:rgb(0, 0, 255)">print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;--&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token keyword" style="color:rgb(0, 0, 255)">print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                </span><span class="token string-interpolation string" style="color:rgb(163, 21, 21)">f&quot;Done agent: </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string-interpolation interpolation">event</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string-interpolation interpolation string" style="color:rgb(163, 21, 21)">&#x27;name&#x27;</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token string-interpolation string" style="color:rgb(163, 21, 21)"> with output: </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string-interpolation interpolation">event</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string-interpolation interpolation string" style="color:rgb(163, 21, 21)">&#x27;data&#x27;</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token string-interpolation interpolation">get</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string-interpolation interpolation string" style="color:rgb(163, 21, 21)">&#x27;output&#x27;</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string-interpolation interpolation string" style="color:rgb(163, 21, 21)">&#x27;output&#x27;</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token string-interpolation string" style="color:rgb(163, 21, 21)">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> kind </span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;on_chat_model_stream&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        content </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> event</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;data&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;chunk&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">content</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> content</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token comment" style="color:rgb(0, 128, 0)"># Empty content in the context of OpenAI means</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token comment" style="color:rgb(0, 128, 0)"># that the model is asking for a tool to be invoked.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token comment" style="color:rgb(0, 128, 0)"># So we only print non-empty content</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token keyword" style="color:rgb(0, 0, 255)">print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">content</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> end</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;|&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">elif</span><span class="token plain"> kind </span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;on_tool_start&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;--&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token string-interpolation string" style="color:rgb(163, 21, 21)">f&quot;Starting tool: </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string-interpolation interpolation">event</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string-interpolation interpolation string" style="color:rgb(163, 21, 21)">&#x27;name&#x27;</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token string-interpolation string" style="color:rgb(163, 21, 21)"> with inputs: </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string-interpolation interpolation">event</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string-interpolation interpolation string" style="color:rgb(163, 21, 21)">&#x27;data&#x27;</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token string-interpolation interpolation">get</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string-interpolation interpolation string" style="color:rgb(163, 21, 21)">&#x27;input&#x27;</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token string-interpolation string" style="color:rgb(163, 21, 21)">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">elif</span><span class="token plain"> kind </span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;on_tool_end&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string-interpolation string" style="color:rgb(163, 21, 21)">f&quot;Done tool: </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string-interpolation interpolation">event</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string-interpolation interpolation string" style="color:rgb(163, 21, 21)">&#x27;name&#x27;</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token string-interpolation string" style="color:rgb(163, 21, 21)">&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string-interpolation string" style="color:rgb(163, 21, 21)">f&quot;Tool output was: </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string-interpolation interpolation">event</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string-interpolation interpolation string" style="color:rgb(163, 21, 21)">&#x27;data&#x27;</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token string-interpolation interpolation">get</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string-interpolation interpolation string" style="color:rgb(163, 21, 21)">&#x27;output&#x27;</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token string-interpolation string" style="color:rgb(163, 21, 21)">&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;--&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-output codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-output codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">Starting agent: Agent with input: {&#x27;input&#x27;: &#x27;where is the cat hiding? what items are in that location?&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Starting tool: where_cat_is_hiding with inputs: {}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Done tool: where_cat_is_hiding</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Tool output was: on the shelf</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Starting tool: get_items with inputs: {&#x27;place&#x27;: &#x27;shelf&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">In| a| shelf|,| you| might| find|:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">|1|.| Books|:| A| shelf| is| commonly| used| to| store| books|.| It| may| contain| various| genres| such| as| novels|,| textbooks|,| or| reference| books|.| Books| provide| knowledge|,| entertainment|,| and| can| transport| you| to| different| worlds| through| storytelling|.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">|2|.| Decor|ative| items|:| Sh|elves| often| display| decorative| items| like| figur|ines|,| v|ases|,| or| photo| frames|.| These| items| add| a| personal| touch| to| the| space| and| can| reflect| the| owner|&#x27;s| interests| or| memories|.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">|3|.| Storage| boxes|:| Sh|elves| can| also| hold| storage| boxes| or| baskets|.| These| containers| help| organize| and| decl|utter| the| space| by| storing| miscellaneous| items| like| documents|,| accessories|,| or| small| household| items|.| They| provide| a| neat| and| tidy| appearance| to| the| shelf|.|Done tool: get_items</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Tool output was: In a shelf, you might find:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">1. Books: A shelf is commonly used to store books. It may contain various genres such as novels, textbooks, or reference books. Books provide knowledge, entertainment, and can transport you to different worlds through storytelling.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">2. Decorative items: Shelves often display decorative items like figurines, vases, or photo frames. These items add a personal touch to the space and can reflect the owner&#x27;s interests or memories.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">3. Storage boxes: Shelves can also hold storage boxes or baskets. These containers help organize and declutter the space by storing miscellaneous items like documents, accessories, or small household items. They provide a neat and tidy appearance to the shelf.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">The| cat| is| hiding| on| the| shelf|.| In| that| location|,| you| might| find| books|,| decorative| items|,| and| storage| boxes|.|</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">--</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Done agent: Agent with output: The cat is hiding on the shelf. In that location, you might find books, decorative items, and storage boxes.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="other-aproaches">Other aproaches<a href="#other-aproaches" class="hash-link" aria-label="Direct link to Other aproaches" title="Direct link to Other aproaches">‚Äã</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="using-astream_log">Using astream_log<a href="#using-astream_log" class="hash-link" aria-label="Direct link to Using astream_log" title="Direct link to Using astream_log">‚Äã</a></h4><p><strong>Note</strong> You can also use the <a href="/v0.1/docs/expression_language/interface/#async-stream-intermediate-steps">astream_log</a> API. This API produces a granular log of all events that occur during execution. The log format is based on the <a href="https://jsonpatch.com/" target="_blank" rel="noopener noreferrer">JSONPatch</a> standard. It&#x27;s granular, but requires effort to parse. For this reason, we created the <code>astream_events</code> API instead.</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">i </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">async</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> chunk </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> agent_executor</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">astream_log</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;input&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;where is the cat hiding? what items are in that location?&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">chunk</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    i </span><span class="token operator" style="color:rgb(0, 0, 0)">+=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">break</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-output codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-output codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">RunLogPatch({&#x27;op&#x27;: &#x27;replace&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;path&#x27;: &#x27;&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;value&#x27;: {&#x27;final_output&#x27;: None,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;id&#x27;: &#x27;c261bc30-60d1-4420-9c66-c6c0797f2c2d&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;logs&#x27;: {},</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;name&#x27;: &#x27;Agent&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;streamed_output&#x27;: [],</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;type&#x27;: &#x27;chain&#x27;}})</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RunLogPatch({&#x27;op&#x27;: &#x27;add&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;path&#x27;: &#x27;/logs/RunnableSequence&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;value&#x27;: {&#x27;end_time&#x27;: None,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;final_output&#x27;: None,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;id&#x27;: &#x27;183cb6f8-ed29-4967-b1ea-024050ce66c7&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;metadata&#x27;: {},</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;name&#x27;: &#x27;RunnableSequence&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;start_time&#x27;: &#x27;2024-01-22T20:38:43.650+00:00&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;streamed_output&#x27;: [],</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;streamed_output_str&#x27;: [],</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;tags&#x27;: [],</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;type&#x27;: &#x27;chain&#x27;}})</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RunLogPatch({&#x27;op&#x27;: &#x27;add&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;path&#x27;: &#x27;/logs/RunnableAssign&lt;agent_scratchpad&gt;&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;value&#x27;: {&#x27;end_time&#x27;: None,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;final_output&#x27;: None,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;id&#x27;: &#x27;7fe1bb27-3daf-492e-bc7e-28602398f008&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;metadata&#x27;: {},</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;name&#x27;: &#x27;RunnableAssign&lt;agent_scratchpad&gt;&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;start_time&#x27;: &#x27;2024-01-22T20:38:43.652+00:00&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;streamed_output&#x27;: [],</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;streamed_output_str&#x27;: [],</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;tags&#x27;: [&#x27;seq:step:1&#x27;],</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;type&#x27;: &#x27;chain&#x27;}})</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RunLogPatch({&#x27;op&#x27;: &#x27;add&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;path&#x27;: &#x27;/logs/RunnableAssign&lt;agent_scratchpad&gt;/streamed_output/-&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;value&#x27;: {&#x27;input&#x27;: &#x27;where is the cat hiding? what items are in that &#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                     &#x27;location?&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;intermediate_steps&#x27;: []}})</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RunLogPatch({&#x27;op&#x27;: &#x27;add&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;path&#x27;: &#x27;/logs/RunnableParallel&lt;agent_scratchpad&gt;&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;value&#x27;: {&#x27;end_time&#x27;: None,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;final_output&#x27;: None,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;id&#x27;: &#x27;b034e867-e6bb-4296-bfe6-752c44fba6ce&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;metadata&#x27;: {},</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;name&#x27;: &#x27;RunnableParallel&lt;agent_scratchpad&gt;&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;start_time&#x27;: &#x27;2024-01-22T20:38:43.652+00:00&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;streamed_output&#x27;: [],</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;streamed_output_str&#x27;: [],</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;tags&#x27;: [],</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;type&#x27;: &#x27;chain&#x27;}})</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RunLogPatch({&#x27;op&#x27;: &#x27;add&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;path&#x27;: &#x27;/logs/RunnableLambda&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;value&#x27;: {&#x27;end_time&#x27;: None,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;final_output&#x27;: None,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;id&#x27;: &#x27;65ceef3e-7a80-4015-8b5b-d949326872e9&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;metadata&#x27;: {},</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;name&#x27;: &#x27;RunnableLambda&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;start_time&#x27;: &#x27;2024-01-22T20:38:43.653+00:00&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;streamed_output&#x27;: [],</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;streamed_output_str&#x27;: [],</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;tags&#x27;: [&#x27;map:key:agent_scratchpad&#x27;],</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;type&#x27;: &#x27;chain&#x27;}})</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RunLogPatch({&#x27;op&#x27;: &#x27;add&#x27;, &#x27;path&#x27;: &#x27;/logs/RunnableLambda/streamed_output/-&#x27;, &#x27;value&#x27;: []})</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RunLogPatch({&#x27;op&#x27;: &#x27;add&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;path&#x27;: &#x27;/logs/RunnableParallel&lt;agent_scratchpad&gt;/streamed_output/-&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;value&#x27;: {&#x27;agent_scratchpad&#x27;: []}})</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RunLogPatch({&#x27;op&#x27;: &#x27;add&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;path&#x27;: &#x27;/logs/RunnableAssign&lt;agent_scratchpad&gt;/streamed_output/-&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;value&#x27;: {&#x27;agent_scratchpad&#x27;: []}})</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RunLogPatch({&#x27;op&#x27;: &#x27;add&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;path&#x27;: &#x27;/logs/RunnableLambda/final_output&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;value&#x27;: {&#x27;output&#x27;: []}},</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> {&#x27;op&#x27;: &#x27;add&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;path&#x27;: &#x27;/logs/RunnableLambda/end_time&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;value&#x27;: &#x27;2024-01-22T20:38:43.654+00:00&#x27;})</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RunLogPatch({&#x27;op&#x27;: &#x27;add&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;path&#x27;: &#x27;/logs/RunnableParallel&lt;agent_scratchpad&gt;/final_output&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;value&#x27;: {&#x27;agent_scratchpad&#x27;: []}},</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> {&#x27;op&#x27;: &#x27;add&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;path&#x27;: &#x27;/logs/RunnableParallel&lt;agent_scratchpad&gt;/end_time&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;value&#x27;: &#x27;2024-01-22T20:38:43.655+00:00&#x27;})</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This may require some logic to get in a workable format</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">i </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">path_status </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">async</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> chunk </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> agent_executor</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">astream_log</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;input&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;where is the cat hiding? what items are in that location?&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> op </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> chunk</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">ops</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> op</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;op&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;add&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> op</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;path&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">not</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> path_status</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                path_status</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">op</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;path&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> op</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;value&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token keyword" style="color:rgb(0, 0, 255)">else</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                path_status</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">op</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;path&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">+=</span><span class="token plain"> op</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;value&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">op</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;path&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">path_status</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">get</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">op</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;path&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;----&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    i </span><span class="token operator" style="color:rgb(0, 0, 0)">+=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">30</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">break</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-output codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-output codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">None</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">----</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/logs/RunnableSequence</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;id&#x27;: &#x27;22bbd5db-9578-4e3f-a6ec-9b61f08cb8a9&#x27;, &#x27;name&#x27;: &#x27;RunnableSequence&#x27;, &#x27;type&#x27;: &#x27;chain&#x27;, &#x27;tags&#x27;: [], &#x27;metadata&#x27;: {}, &#x27;start_time&#x27;: &#x27;2024-01-22T20:38:43.668+00:00&#x27;, &#x27;streamed_output&#x27;: [], &#x27;streamed_output_str&#x27;: [], &#x27;final_output&#x27;: None, &#x27;end_time&#x27;: None}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">----</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/logs/RunnableAssign&lt;agent_scratchpad&gt;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;id&#x27;: &#x27;e0c00ae2-aaa2-4a09-bc93-cb34bf3f6554&#x27;, &#x27;name&#x27;: &#x27;RunnableAssign&lt;agent_scratchpad&gt;&#x27;, &#x27;type&#x27;: &#x27;chain&#x27;, &#x27;tags&#x27;: [&#x27;seq:step:1&#x27;], &#x27;metadata&#x27;: {}, &#x27;start_time&#x27;: &#x27;2024-01-22T20:38:43.672+00:00&#x27;, &#x27;streamed_output&#x27;: [], &#x27;streamed_output_str&#x27;: [], &#x27;final_output&#x27;: None, &#x27;end_time&#x27;: None}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">----</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/logs/RunnableAssign&lt;agent_scratchpad&gt;/streamed_output/-</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;input&#x27;: &#x27;where is the cat hiding? what items are in that location?&#x27;, &#x27;intermediate_steps&#x27;: []}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">----</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/logs/RunnableParallel&lt;agent_scratchpad&gt;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;id&#x27;: &#x27;26ff576d-ff9d-4dea-98b2-943312a37f4d&#x27;, &#x27;name&#x27;: &#x27;RunnableParallel&lt;agent_scratchpad&gt;&#x27;, &#x27;type&#x27;: &#x27;chain&#x27;, &#x27;tags&#x27;: [], &#x27;metadata&#x27;: {}, &#x27;start_time&#x27;: &#x27;2024-01-22T20:38:43.674+00:00&#x27;, &#x27;streamed_output&#x27;: [], &#x27;streamed_output_str&#x27;: [], &#x27;final_output&#x27;: None, &#x27;end_time&#x27;: None}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">----</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/logs/RunnableLambda</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;id&#x27;: &#x27;9f343c6a-23f7-4a28-832f-d4fe3e95d1dc&#x27;, &#x27;name&#x27;: &#x27;RunnableLambda&#x27;, &#x27;type&#x27;: &#x27;chain&#x27;, &#x27;tags&#x27;: [&#x27;map:key:agent_scratchpad&#x27;], &#x27;metadata&#x27;: {}, &#x27;start_time&#x27;: &#x27;2024-01-22T20:38:43.685+00:00&#x27;, &#x27;streamed_output&#x27;: [], &#x27;streamed_output_str&#x27;: [], &#x27;final_output&#x27;: None, &#x27;end_time&#x27;: None}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">----</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/logs/RunnableLambda/streamed_output/-</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">[]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">----</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/logs/RunnableParallel&lt;agent_scratchpad&gt;/streamed_output/-</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;agent_scratchpad&#x27;: []}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">----</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/logs/RunnableAssign&lt;agent_scratchpad&gt;/streamed_output/-</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;input&#x27;: &#x27;where is the cat hiding? what items are in that location?&#x27;, &#x27;intermediate_steps&#x27;: [], &#x27;agent_scratchpad&#x27;: []}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">----</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/logs/RunnableLambda/end_time</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">2024-01-22T20:38:43.687+00:00</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">----</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/logs/RunnableParallel&lt;agent_scratchpad&gt;/end_time</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">2024-01-22T20:38:43.688+00:00</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">----</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/logs/RunnableAssign&lt;agent_scratchpad&gt;/end_time</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">2024-01-22T20:38:43.688+00:00</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">----</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/logs/ChatPromptTemplate</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;id&#x27;: &#x27;7e3a84d5-46b8-4782-8eed-d1fe92be6a30&#x27;, &#x27;name&#x27;: &#x27;ChatPromptTemplate&#x27;, &#x27;type&#x27;: &#x27;prompt&#x27;, &#x27;tags&#x27;: [&#x27;seq:step:2&#x27;], &#x27;metadata&#x27;: {}, &#x27;start_time&#x27;: &#x27;2024-01-22T20:38:43.689+00:00&#x27;, &#x27;streamed_output&#x27;: [], &#x27;streamed_output_str&#x27;: [], &#x27;final_output&#x27;: None, &#x27;end_time&#x27;: None}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">----</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/logs/ChatPromptTemplate/end_time</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">2024-01-22T20:38:43.689+00:00</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">----</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/logs/ChatOpenAI</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;id&#x27;: &#x27;6446f7ec-b3e4-4637-89d8-b4b34b46ea14&#x27;, &#x27;name&#x27;: &#x27;ChatOpenAI&#x27;, &#x27;type&#x27;: &#x27;llm&#x27;, &#x27;tags&#x27;: [&#x27;seq:step:3&#x27;, &#x27;agent_llm&#x27;], &#x27;metadata&#x27;: {}, &#x27;start_time&#x27;: &#x27;2024-01-22T20:38:43.690+00:00&#x27;, &#x27;streamed_output&#x27;: [], &#x27;streamed_output_str&#x27;: [], &#x27;final_output&#x27;: None, &#x27;end_time&#x27;: None}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">----</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/logs/ChatOpenAI/streamed_output/-</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">content=&#x27;&#x27; additional_kwargs={&#x27;tool_calls&#x27;: [{&#x27;index&#x27;: 0, &#x27;id&#x27;: &#x27;call_gKFg6FX8ZQ88wFUs94yx86PF&#x27;, &#x27;function&#x27;: {&#x27;arguments&#x27;: &#x27;&#x27;, &#x27;name&#x27;: &#x27;where_cat_is_hiding&#x27;}, &#x27;type&#x27;: &#x27;function&#x27;}]}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">----</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/logs/ChatOpenAI/streamed_output/-</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">content=&#x27;&#x27; additional_kwargs={&#x27;tool_calls&#x27;: [{&#x27;index&#x27;: 0, &#x27;id&#x27;: &#x27;call_gKFg6FX8ZQ88wFUs94yx86PF&#x27;, &#x27;function&#x27;: {&#x27;arguments&#x27;: &#x27;{}&#x27;, &#x27;name&#x27;: &#x27;where_cat_is_hiding&#x27;}, &#x27;type&#x27;: &#x27;function&#x27;}]}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">----</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/logs/ChatOpenAI/streamed_output/-</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">content=&#x27;&#x27; additional_kwargs={&#x27;tool_calls&#x27;: [{&#x27;index&#x27;: 0, &#x27;id&#x27;: &#x27;call_gKFg6FX8ZQ88wFUs94yx86PF&#x27;, &#x27;function&#x27;: {&#x27;arguments&#x27;: &#x27;{}&#x27;, &#x27;name&#x27;: &#x27;where_cat_is_hiding&#x27;}, &#x27;type&#x27;: &#x27;function&#x27;}]}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">----</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/logs/ChatOpenAI/end_time</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">2024-01-22T20:38:44.203+00:00</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">----</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/logs/OpenAIToolsAgentOutputParser</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;id&#x27;: &#x27;65912835-8dcd-4be2-ad05-9f239a7ef704&#x27;, &#x27;name&#x27;: &#x27;OpenAIToolsAgentOutputParser&#x27;, &#x27;type&#x27;: &#x27;parser&#x27;, &#x27;tags&#x27;: [&#x27;seq:step:4&#x27;], &#x27;metadata&#x27;: {}, &#x27;start_time&#x27;: &#x27;2024-01-22T20:38:44.204+00:00&#x27;, &#x27;streamed_output&#x27;: [], &#x27;streamed_output_str&#x27;: [], &#x27;final_output&#x27;: None, &#x27;end_time&#x27;: None}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">----</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/logs/OpenAIToolsAgentOutputParser/end_time</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">2024-01-22T20:38:44.205+00:00</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">----</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/logs/RunnableSequence/streamed_output/-</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">[OpenAIToolAgentAction(tool=&#x27;where_cat_is_hiding&#x27;, tool_input={}, log=&#x27;\nInvoking: `where_cat_is_hiding` with `{}`\n\n\n&#x27;, message_log=[AIMessageChunk(content=&#x27;&#x27;, additional_kwargs={&#x27;tool_calls&#x27;: [{&#x27;index&#x27;: 0, &#x27;id&#x27;: &#x27;call_gKFg6FX8ZQ88wFUs94yx86PF&#x27;, &#x27;function&#x27;: {&#x27;arguments&#x27;: &#x27;{}&#x27;, &#x27;name&#x27;: &#x27;where_cat_is_hiding&#x27;}, &#x27;type&#x27;: &#x27;function&#x27;}]})], tool_call_id=&#x27;call_gKFg6FX8ZQ88wFUs94yx86PF&#x27;)]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">----</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/logs/RunnableSequence/end_time</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">2024-01-22T20:38:44.206+00:00</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">----</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/final_output</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">None</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">----</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/logs/where_cat_is_hiding</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;id&#x27;: &#x27;21fde139-0dfa-42bb-ad90-b5b1e984aaba&#x27;, &#x27;name&#x27;: &#x27;where_cat_is_hiding&#x27;, &#x27;type&#x27;: &#x27;tool&#x27;, &#x27;tags&#x27;: [], &#x27;metadata&#x27;: {}, &#x27;start_time&#x27;: &#x27;2024-01-22T20:38:44.208+00:00&#x27;, &#x27;streamed_output&#x27;: [], &#x27;streamed_output_str&#x27;: [], &#x27;final_output&#x27;: None, &#x27;end_time&#x27;: None}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">----</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/logs/where_cat_is_hiding/end_time</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">2024-01-22T20:38:44.208+00:00</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">----</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/final_output/messages/1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">content=&#x27;under the bed&#x27; name=&#x27;where_cat_is_hiding&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">----</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/logs/RunnableSequence:2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;id&#x27;: &#x27;37d52845-b689-4c18-9c10-ffdd0c4054b0&#x27;, &#x27;name&#x27;: &#x27;RunnableSequence&#x27;, &#x27;type&#x27;: &#x27;chain&#x27;, &#x27;tags&#x27;: [], &#x27;metadata&#x27;: {}, &#x27;start_time&#x27;: &#x27;2024-01-22T20:38:44.210+00:00&#x27;, &#x27;streamed_output&#x27;: [], &#x27;streamed_output_str&#x27;: [], &#x27;final_output&#x27;: None, &#x27;end_time&#x27;: None}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">----</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/logs/RunnableAssign&lt;agent_scratchpad&gt;:2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;id&#x27;: &#x27;30024dea-064f-4b04-b130-671f47ac59bc&#x27;, &#x27;name&#x27;: &#x27;RunnableAssign&lt;agent_scratchpad&gt;&#x27;, &#x27;type&#x27;: &#x27;chain&#x27;, &#x27;tags&#x27;: [&#x27;seq:step:1&#x27;], &#x27;metadata&#x27;: {}, &#x27;start_time&#x27;: &#x27;2024-01-22T20:38:44.213+00:00&#x27;, &#x27;streamed_output&#x27;: [], &#x27;streamed_output_str&#x27;: [], &#x27;final_output&#x27;: None, &#x27;end_time&#x27;: None}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">----</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/logs/RunnableAssign&lt;agent_scratchpad&gt;:2/streamed_output/-</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;input&#x27;: &#x27;where is the cat hiding? what items are in that location?&#x27;, &#x27;intermediate_steps&#x27;: [(OpenAIToolAgentAction(tool=&#x27;where_cat_is_hiding&#x27;, tool_input={}, log=&#x27;\nInvoking: `where_cat_is_hiding` with `{}`\n\n\n&#x27;, message_log=[AIMessageChunk(content=&#x27;&#x27;, additional_kwargs={&#x27;tool_calls&#x27;: [{&#x27;index&#x27;: 0, &#x27;id&#x27;: &#x27;call_gKFg6FX8ZQ88wFUs94yx86PF&#x27;, &#x27;function&#x27;: {&#x27;arguments&#x27;: &#x27;{}&#x27;, &#x27;name&#x27;: &#x27;where_cat_is_hiding&#x27;}, &#x27;type&#x27;: &#x27;function&#x27;}]})], tool_call_id=&#x27;call_gKFg6FX8ZQ88wFUs94yx86PF&#x27;), &#x27;under the bed&#x27;)]}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">----</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/logs/RunnableParallel&lt;agent_scratchpad&gt;:2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;id&#x27;: &#x27;98906cd7-93c2-47e8-a7d7-2e8d4ab09ed0&#x27;, &#x27;name&#x27;: &#x27;RunnableParallel&lt;agent_scratchpad&gt;&#x27;, &#x27;type&#x27;: &#x27;chain&#x27;, &#x27;tags&#x27;: [], &#x27;metadata&#x27;: {}, &#x27;start_time&#x27;: &#x27;2024-01-22T20:38:44.215+00:00&#x27;, &#x27;streamed_output&#x27;: [], &#x27;streamed_output_str&#x27;: [], &#x27;final_output&#x27;: None, &#x27;end_time&#x27;: None}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">----</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="using-callbacks-legacy">Using callbacks (Legacy)<a href="#using-callbacks-legacy" class="hash-link" aria-label="Direct link to Using callbacks (Legacy)" title="Direct link to Using callbacks (Legacy)">‚Äã</a></h4><p>Another approach to streaming is using callbacks. This may be useful if you&#x27;re still on an older version of LangChain and cannot upgrade.</p><p>Generall, this is <strong>NOT</strong> a recommended approach because:</p><ol><li>for most applications, you&#x27;ll need to create two workers, write the callbacks to a queue and have another worker reading from the queue (i.e., there&#x27;s hidden complexity to make this work).</li><li><strong>end</strong> events may be missing some metadata (e.g., like run name). So if you need the additional metadata, you should inherit from <code>BaseTracer</code> instead of <code>AsyncCallbackHandler</code> to pick up the relevant information from the runs (aka traces), or else implement the aggregation logic yourself based on the <code>run_id</code>.</li><li>There is inconsistent behavior with the callbacks (e.g., how inputs and outputs are encoded) depending on the callback type that you&#x27;ll need to workaround.</li></ol><p>For illustration purposes, we implement a callback below that shows how to get <em>token by token</em> streaming. Feel free to implement other callbacks based on your application needs.</p><p>But <code>astream_events</code> does all of this you under the hood, so you don&#x27;t have to!</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">from</span><span class="token plain"> typing </span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> TYPE_CHECKING</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> Any</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> Dict</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> List</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> Optional</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> Sequence</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> TypeVar</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> Union</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">from</span><span class="token plain"> uuid </span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> UUID</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">from</span><span class="token plain"> langchain_core</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">callbacks</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">base </span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> AsyncCallbackHandler</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">from</span><span class="token plain"> langchain_core</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">messages </span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> BaseMessage</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">from</span><span class="token plain"> langchain_core</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">outputs </span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> ChatGenerationChunk</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> GenerationChunk</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> LLMResult</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Here is a custom handler that will print the tokens to stdout.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Instead of printing to stdout you can send the data elsewhere; e.g., to a streaming API response</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">TokenByTokenHandler</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">AsyncCallbackHandler</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">__init__</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> tags_of_interest</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> List</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token builtin" style="color:rgb(0, 112, 193)">str</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token boolean">None</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:rgb(163, 21, 21)">&quot;&quot;&quot;A custom call back handler.</span><br></span><span class="token-line" style="color:#000000"><span class="token triple-quoted-string string" style="display:inline-block;color:rgb(163, 21, 21)"></span><br></span><span class="token-line" style="color:#000000"><span class="token triple-quoted-string string" style="color:rgb(163, 21, 21)">        Args:</span><br></span><span class="token-line" style="color:#000000"><span class="token triple-quoted-string string" style="color:rgb(163, 21, 21)">            tags_of_interest: Only LLM tokens from models with these tags will be</span><br></span><span class="token-line" style="color:#000000"><span class="token triple-quoted-string string" style="color:rgb(163, 21, 21)">                              printed.</span><br></span><span class="token-line" style="color:#000000"><span class="token triple-quoted-string string" style="color:rgb(163, 21, 21)">        &quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">tags_of_interest </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> tags_of_interest</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">async</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">on_chain_start</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        serialized</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Dict</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token builtin" style="color:rgb(0, 112, 193)">str</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> Any</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        inputs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Dict</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token builtin" style="color:rgb(0, 112, 193)">str</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> Any</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        run_id</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> UUID</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        parent_run_id</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Optional</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">UUID</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token boolean">None</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        tags</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Optional</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">List</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token builtin" style="color:rgb(0, 112, 193)">str</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token boolean">None</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Optional</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">Dict</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token builtin" style="color:rgb(0, 112, 193)">str</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> Any</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token boolean">None</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token operator" style="color:rgb(0, 0, 0)">**</span><span class="token plain">kwargs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Any</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token boolean">None</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:rgb(163, 21, 21)">&quot;&quot;&quot;Run when chain starts running.&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;on chain start: &quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">inputs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">async</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">on_chain_end</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        outputs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Dict</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token builtin" style="color:rgb(0, 112, 193)">str</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> Any</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        run_id</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> UUID</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        parent_run_id</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Optional</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">UUID</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token boolean">None</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        tags</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Optional</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">List</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token builtin" style="color:rgb(0, 112, 193)">str</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token boolean">None</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token operator" style="color:rgb(0, 0, 0)">**</span><span class="token plain">kwargs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Any</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token boolean">None</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:rgb(163, 21, 21)">&quot;&quot;&quot;Run when chain ends running.&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;On chain end&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">outputs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">async</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">on_chat_model_start</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        serialized</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Dict</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token builtin" style="color:rgb(0, 112, 193)">str</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> Any</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        messages</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> List</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">List</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">BaseMessage</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        run_id</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> UUID</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        parent_run_id</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Optional</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">UUID</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token boolean">None</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        tags</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Optional</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">List</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token builtin" style="color:rgb(0, 112, 193)">str</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token boolean">None</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Optional</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">Dict</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token builtin" style="color:rgb(0, 112, 193)">str</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> Any</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token boolean">None</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token operator" style="color:rgb(0, 0, 0)">**</span><span class="token plain">kwargs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Any</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> Any</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:rgb(163, 21, 21)">&quot;&quot;&quot;Run when a chat model starts running.&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        overlap_tags </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">get_overlap_tags</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">tags</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> overlap_tags</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token keyword" style="color:rgb(0, 0, 255)">print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;,&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">join</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">overlap_tags</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> end</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;: &quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> flush</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token boolean">True</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">on_tool_start</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        serialized</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Dict</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token builtin" style="color:rgb(0, 112, 193)">str</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> Any</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        input_str</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(0, 112, 193)">str</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        run_id</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> UUID</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        parent_run_id</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Optional</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">UUID</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token boolean">None</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        tags</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Optional</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">List</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token builtin" style="color:rgb(0, 112, 193)">str</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token boolean">None</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Optional</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">Dict</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token builtin" style="color:rgb(0, 112, 193)">str</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> Any</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token boolean">None</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        inputs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Optional</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">Dict</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token builtin" style="color:rgb(0, 112, 193)">str</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> Any</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token boolean">None</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token operator" style="color:rgb(0, 0, 0)">**</span><span class="token plain">kwargs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Any</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> Any</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:rgb(163, 21, 21)">&quot;&quot;&quot;Run when tool starts running.&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Tool start&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">serialized</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">on_tool_end</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        output</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Any</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        run_id</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> UUID</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        parent_run_id</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Optional</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">UUID</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token boolean">None</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token operator" style="color:rgb(0, 0, 0)">**</span><span class="token plain">kwargs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Any</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> Any</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:rgb(163, 21, 21)">&quot;&quot;&quot;Run when tool ends running.&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Tool end&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token builtin" style="color:rgb(0, 112, 193)">str</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">output</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">async</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">on_llm_end</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        response</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> LLMResult</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        run_id</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> UUID</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        parent_run_id</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Optional</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">UUID</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token boolean">None</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        tags</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Optional</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">List</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token builtin" style="color:rgb(0, 112, 193)">str</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token boolean">None</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token operator" style="color:rgb(0, 0, 0)">**</span><span class="token plain">kwargs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Any</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token boolean">None</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:rgb(163, 21, 21)">&quot;&quot;&quot;Run when LLM ends running.&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        overlap_tags </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">get_overlap_tags</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">tags</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> overlap_tags</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token comment" style="color:rgb(0, 128, 0)"># Who can argue with beauty?</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token keyword" style="color:rgb(0, 0, 255)">print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token keyword" style="color:rgb(0, 0, 255)">print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">get_overlap_tags</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> tags</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Optional</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">List</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token builtin" style="color:rgb(0, 112, 193)">str</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> List</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token builtin" style="color:rgb(0, 112, 193)">str</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:rgb(163, 21, 21)">&quot;&quot;&quot;Check for overlap with filtered tags.&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">not</span><span class="token plain"> tags</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token keyword" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(0, 112, 193)">sorted</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token builtin" style="color:rgb(0, 112, 193)">set</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">tags </span><span class="token keyword" style="color:rgb(0, 0, 255)">or</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&amp;</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(0, 112, 193)">set</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">tags_of_interest </span><span class="token keyword" style="color:rgb(0, 0, 255)">or</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">async</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">on_llm_new_token</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        self</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        token</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(0, 112, 193)">str</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        chunk</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Optional</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">Union</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">GenerationChunk</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> ChatGenerationChunk</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token boolean">None</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        run_id</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> UUID</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        parent_run_id</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Optional</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">UUID</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token boolean">None</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        tags</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Optional</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">List</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token builtin" style="color:rgb(0, 112, 193)">str</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token boolean">None</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token operator" style="color:rgb(0, 0, 0)">**</span><span class="token plain">kwargs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Any</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token boolean">None</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:rgb(163, 21, 21)">&quot;&quot;&quot;Run on new LLM token. Only available when streaming is enabled.&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        overlap_tags </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">get_overlap_tags</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">tags</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> token </span><span class="token keyword" style="color:rgb(0, 0, 255)">and</span><span class="token plain"> overlap_tags</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token keyword" style="color:rgb(0, 0, 255)">print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">token</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> end</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;|&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> flush</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token boolean">True</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">handler </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> TokenByTokenHandler</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">tags_of_interest</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;tool_llm&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;agent_llm&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">result </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">await</span><span class="token plain"> agent_executor</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">ainvoke</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;input&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;where is the cat hiding and what items can be found there?&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;callbacks&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">handler</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div style="padding-top:1.3rem;background:var(--prism-background-color);color:var(--prism-color);margin-top:calc(-1 * var(--ifm-leading) - 5px);margin-bottom:var(--ifm-leading);box-shadow:var(--ifm-global-shadow-lw);border-bottom-left-radius:var(--ifm-code-border-radius);border-bottom-right-radius:var(--ifm-code-border-radius)"><h4 style="padding-left:0.65rem;margin-bottom:0.45rem">API Reference:</h4><ul style="padding-bottom:1rem"><li><a href="https://api.python.langchain.com/en/latest/callbacks/langchain_core.callbacks.base.AsyncCallbackHandler.html"><span>AsyncCallbackHandler</span></a></li><li><a href="https://api.python.langchain.com/en/latest/messages/langchain_core.messages.base.BaseMessage.html"><span>BaseMessage</span></a></li><li><a href="https://api.python.langchain.com/en/latest/outputs/langchain_core.outputs.chat_generation.ChatGenerationChunk.html"><span>ChatGenerationChunk</span></a></li><li><a href="https://api.python.langchain.com/en/latest/outputs/langchain_core.outputs.generation.GenerationChunk.html"><span>GenerationChunk</span></a></li><li><a href="https://api.python.langchain.com/en/latest/outputs/langchain_core.outputs.llm_result.LLMResult.html"><span>LLMResult</span></a></li></ul></div><div class="language-output codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-output codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">on chain start: </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;input&#x27;: &#x27;where is the cat hiding and what items can be found there?&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">on chain start: </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;input&#x27;: &#x27;&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">on chain start: </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;input&#x27;: &#x27;&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">on chain start: </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;input&#x27;: &#x27;&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">on chain start: </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;input&#x27;: &#x27;&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">On chain end</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">[]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">On chain end</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;agent_scratchpad&#x27;: []}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">On chain end</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;input&#x27;: &#x27;where is the cat hiding and what items can be found there?&#x27;, &#x27;intermediate_steps&#x27;: [], &#x27;agent_scratchpad&#x27;: []}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">on chain start: </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;input&#x27;: &#x27;where is the cat hiding and what items can be found there?&#x27;, &#x27;intermediate_steps&#x27;: [], &#x27;agent_scratchpad&#x27;: []}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">On chain end</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;lc&#x27;: 1, &#x27;type&#x27;: &#x27;constructor&#x27;, &#x27;id&#x27;: [&#x27;langchain&#x27;, &#x27;prompts&#x27;, &#x27;chat&#x27;, &#x27;ChatPromptValue&#x27;], &#x27;kwargs&#x27;: {&#x27;messages&#x27;: [{&#x27;lc&#x27;: 1, &#x27;type&#x27;: &#x27;constructor&#x27;, &#x27;id&#x27;: [&#x27;langchain&#x27;, &#x27;schema&#x27;, &#x27;messages&#x27;, &#x27;SystemMessage&#x27;], &#x27;kwargs&#x27;: {&#x27;content&#x27;: &#x27;You are a helpful assistant&#x27;, &#x27;additional_kwargs&#x27;: {}}}, {&#x27;lc&#x27;: 1, &#x27;type&#x27;: &#x27;constructor&#x27;, &#x27;id&#x27;: [&#x27;langchain&#x27;, &#x27;schema&#x27;, &#x27;messages&#x27;, &#x27;HumanMessage&#x27;], &#x27;kwargs&#x27;: {&#x27;content&#x27;: &#x27;where is the cat hiding and what items can be found there?&#x27;, &#x27;additional_kwargs&#x27;: {}}}]}}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">agent_llm: </span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">on chain start: </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">content=&#x27;&#x27; additional_kwargs={&#x27;tool_calls&#x27;: [{&#x27;index&#x27;: 0, &#x27;id&#x27;: &#x27;call_pboyZTT0587rJtujUluO2OOc&#x27;, &#x27;function&#x27;: {&#x27;arguments&#x27;: &#x27;{}&#x27;, &#x27;name&#x27;: &#x27;where_cat_is_hiding&#x27;}, &#x27;type&#x27;: &#x27;function&#x27;}]}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">On chain end</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">[{&#x27;lc&#x27;: 1, &#x27;type&#x27;: &#x27;constructor&#x27;, &#x27;id&#x27;: [&#x27;langchain&#x27;, &#x27;schema&#x27;, &#x27;agent&#x27;, &#x27;OpenAIToolAgentAction&#x27;], &#x27;kwargs&#x27;: {&#x27;tool&#x27;: &#x27;where_cat_is_hiding&#x27;, &#x27;tool_input&#x27;: {}, &#x27;log&#x27;: &#x27;\nInvoking: `where_cat_is_hiding` with `{}`\n\n\n&#x27;, &#x27;message_log&#x27;: [{&#x27;lc&#x27;: 1, &#x27;type&#x27;: &#x27;constructor&#x27;, &#x27;id&#x27;: [&#x27;langchain&#x27;, &#x27;schema&#x27;, &#x27;messages&#x27;, &#x27;AIMessageChunk&#x27;], &#x27;kwargs&#x27;: {&#x27;example&#x27;: False, &#x27;content&#x27;: &#x27;&#x27;, &#x27;additional_kwargs&#x27;: {&#x27;tool_calls&#x27;: [{&#x27;index&#x27;: 0, &#x27;id&#x27;: &#x27;call_pboyZTT0587rJtujUluO2OOc&#x27;, &#x27;function&#x27;: {&#x27;arguments&#x27;: &#x27;{}&#x27;, &#x27;name&#x27;: &#x27;where_cat_is_hiding&#x27;}, &#x27;type&#x27;: &#x27;function&#x27;}]}}}], &#x27;tool_call_id&#x27;: &#x27;call_pboyZTT0587rJtujUluO2OOc&#x27;}}]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">On chain end</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">[OpenAIToolAgentAction(tool=&#x27;where_cat_is_hiding&#x27;, tool_input={}, log=&#x27;\nInvoking: `where_cat_is_hiding` with `{}`\n\n\n&#x27;, message_log=[AIMessageChunk(content=&#x27;&#x27;, additional_kwargs={&#x27;tool_calls&#x27;: [{&#x27;index&#x27;: 0, &#x27;id&#x27;: &#x27;call_pboyZTT0587rJtujUluO2OOc&#x27;, &#x27;function&#x27;: {&#x27;arguments&#x27;: &#x27;{}&#x27;, &#x27;name&#x27;: &#x27;where_cat_is_hiding&#x27;}, &#x27;type&#x27;: &#x27;function&#x27;}]})], tool_call_id=&#x27;call_pboyZTT0587rJtujUluO2OOc&#x27;)]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Tool start</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;name&#x27;: &#x27;where_cat_is_hiding&#x27;, &#x27;description&#x27;: &#x27;where_cat_is_hiding() -&gt; str - Where is the cat hiding right now?&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Tool end</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">on the shelf</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">on chain start: </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;input&#x27;: &#x27;&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">on chain start: </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;input&#x27;: &#x27;&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">on chain start: </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;input&#x27;: &#x27;&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">on chain start: </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;input&#x27;: &#x27;&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">On chain end</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">[AIMessageChunk(content=&#x27;&#x27;, additional_kwargs={&#x27;tool_calls&#x27;: [{&#x27;index&#x27;: 0, &#x27;id&#x27;: &#x27;call_pboyZTT0587rJtujUluO2OOc&#x27;, &#x27;function&#x27;: {&#x27;arguments&#x27;: &#x27;{}&#x27;, &#x27;name&#x27;: &#x27;where_cat_is_hiding&#x27;}, &#x27;type&#x27;: &#x27;function&#x27;}]}), ToolMessage(content=&#x27;on the shelf&#x27;, additional_kwargs={&#x27;name&#x27;: &#x27;where_cat_is_hiding&#x27;}, tool_call_id=&#x27;call_pboyZTT0587rJtujUluO2OOc&#x27;)]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">On chain end</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;agent_scratchpad&#x27;: [AIMessageChunk(content=&#x27;&#x27;, additional_kwargs={&#x27;tool_calls&#x27;: [{&#x27;index&#x27;: 0, &#x27;id&#x27;: &#x27;call_pboyZTT0587rJtujUluO2OOc&#x27;, &#x27;function&#x27;: {&#x27;arguments&#x27;: &#x27;{}&#x27;, &#x27;name&#x27;: &#x27;where_cat_is_hiding&#x27;}, &#x27;type&#x27;: &#x27;function&#x27;}]}), ToolMessage(content=&#x27;on the shelf&#x27;, additional_kwargs={&#x27;name&#x27;: &#x27;where_cat_is_hiding&#x27;}, tool_call_id=&#x27;call_pboyZTT0587rJtujUluO2OOc&#x27;)]}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">On chain end</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;input&#x27;: &#x27;where is the cat hiding and what items can be found there?&#x27;, &#x27;intermediate_steps&#x27;: [(OpenAIToolAgentAction(tool=&#x27;where_cat_is_hiding&#x27;, tool_input={}, log=&#x27;\nInvoking: `where_cat_is_hiding` with `{}`\n\n\n&#x27;, message_log=[AIMessageChunk(content=&#x27;&#x27;, additional_kwargs={&#x27;tool_calls&#x27;: [{&#x27;index&#x27;: 0, &#x27;id&#x27;: &#x27;call_pboyZTT0587rJtujUluO2OOc&#x27;, &#x27;function&#x27;: {&#x27;arguments&#x27;: &#x27;{}&#x27;, &#x27;name&#x27;: &#x27;where_cat_is_hiding&#x27;}, &#x27;type&#x27;: &#x27;function&#x27;}]})], tool_call_id=&#x27;call_pboyZTT0587rJtujUluO2OOc&#x27;), &#x27;on the shelf&#x27;)], &#x27;agent_scratchpad&#x27;: [AIMessageChunk(content=&#x27;&#x27;, additional_kwargs={&#x27;tool_calls&#x27;: [{&#x27;index&#x27;: 0, &#x27;id&#x27;: &#x27;call_pboyZTT0587rJtujUluO2OOc&#x27;, &#x27;function&#x27;: {&#x27;arguments&#x27;: &#x27;{}&#x27;, &#x27;name&#x27;: &#x27;where_cat_is_hiding&#x27;}, &#x27;type&#x27;: &#x27;function&#x27;}]}), ToolMessage(content=&#x27;on the shelf&#x27;, additional_kwargs={&#x27;name&#x27;: &#x27;where_cat_is_hiding&#x27;}, tool_call_id=&#x27;call_pboyZTT0587rJtujUluO2OOc&#x27;)]}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">on chain start: </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;input&#x27;: &#x27;where is the cat hiding and what items can be found there?&#x27;, &#x27;intermediate_steps&#x27;: [(OpenAIToolAgentAction(tool=&#x27;where_cat_is_hiding&#x27;, tool_input={}, log=&#x27;\nInvoking: `where_cat_is_hiding` with `{}`\n\n\n&#x27;, message_log=[AIMessageChunk(content=&#x27;&#x27;, additional_kwargs={&#x27;tool_calls&#x27;: [{&#x27;index&#x27;: 0, &#x27;id&#x27;: &#x27;call_pboyZTT0587rJtujUluO2OOc&#x27;, &#x27;function&#x27;: {&#x27;arguments&#x27;: &#x27;{}&#x27;, &#x27;name&#x27;: &#x27;where_cat_is_hiding&#x27;}, &#x27;type&#x27;: &#x27;function&#x27;}]})], tool_call_id=&#x27;call_pboyZTT0587rJtujUluO2OOc&#x27;), &#x27;on the shelf&#x27;)], &#x27;agent_scratchpad&#x27;: [AIMessageChunk(content=&#x27;&#x27;, additional_kwargs={&#x27;tool_calls&#x27;: [{&#x27;index&#x27;: 0, &#x27;id&#x27;: &#x27;call_pboyZTT0587rJtujUluO2OOc&#x27;, &#x27;function&#x27;: {&#x27;arguments&#x27;: &#x27;{}&#x27;, &#x27;name&#x27;: &#x27;where_cat_is_hiding&#x27;}, &#x27;type&#x27;: &#x27;function&#x27;}]}), ToolMessage(content=&#x27;on the shelf&#x27;, additional_kwargs={&#x27;name&#x27;: &#x27;where_cat_is_hiding&#x27;}, tool_call_id=&#x27;call_pboyZTT0587rJtujUluO2OOc&#x27;)]}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">On chain end</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;lc&#x27;: 1, &#x27;type&#x27;: &#x27;constructor&#x27;, &#x27;id&#x27;: [&#x27;langchain&#x27;, &#x27;prompts&#x27;, &#x27;chat&#x27;, &#x27;ChatPromptValue&#x27;], &#x27;kwargs&#x27;: {&#x27;messages&#x27;: [{&#x27;lc&#x27;: 1, &#x27;type&#x27;: &#x27;constructor&#x27;, &#x27;id&#x27;: [&#x27;langchain&#x27;, &#x27;schema&#x27;, &#x27;messages&#x27;, &#x27;SystemMessage&#x27;], &#x27;kwargs&#x27;: {&#x27;content&#x27;: &#x27;You are a helpful assistant&#x27;, &#x27;additional_kwargs&#x27;: {}}}, {&#x27;lc&#x27;: 1, &#x27;type&#x27;: &#x27;constructor&#x27;, &#x27;id&#x27;: [&#x27;langchain&#x27;, &#x27;schema&#x27;, &#x27;messages&#x27;, &#x27;HumanMessage&#x27;], &#x27;kwargs&#x27;: {&#x27;content&#x27;: &#x27;where is the cat hiding and what items can be found there?&#x27;, &#x27;additional_kwargs&#x27;: {}}}, {&#x27;lc&#x27;: 1, &#x27;type&#x27;: &#x27;constructor&#x27;, &#x27;id&#x27;: [&#x27;langchain&#x27;, &#x27;schema&#x27;, &#x27;messages&#x27;, &#x27;AIMessageChunk&#x27;], &#x27;kwargs&#x27;: {&#x27;example&#x27;: False, &#x27;content&#x27;: &#x27;&#x27;, &#x27;additional_kwargs&#x27;: {&#x27;tool_calls&#x27;: [{&#x27;index&#x27;: 0, &#x27;id&#x27;: &#x27;call_pboyZTT0587rJtujUluO2OOc&#x27;, &#x27;function&#x27;: {&#x27;arguments&#x27;: &#x27;{}&#x27;, &#x27;name&#x27;: &#x27;where_cat_is_hiding&#x27;}, &#x27;type&#x27;: &#x27;function&#x27;}]}}}, {&#x27;lc&#x27;: 1, &#x27;type&#x27;: &#x27;constructor&#x27;, &#x27;id&#x27;: [&#x27;langchain&#x27;, &#x27;schema&#x27;, &#x27;messages&#x27;, &#x27;ToolMessage&#x27;], &#x27;kwargs&#x27;: {&#x27;tool_call_id&#x27;: &#x27;call_pboyZTT0587rJtujUluO2OOc&#x27;, &#x27;content&#x27;: &#x27;on the shelf&#x27;, &#x27;additional_kwargs&#x27;: {&#x27;name&#x27;: &#x27;where_cat_is_hiding&#x27;}}}]}}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">agent_llm: </span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">on chain start: </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">content=&#x27;&#x27; additional_kwargs={&#x27;tool_calls&#x27;: [{&#x27;index&#x27;: 0, &#x27;id&#x27;: &#x27;call_vIVtgUb9Gvmc3zAGIrshnmbh&#x27;, &#x27;function&#x27;: {&#x27;arguments&#x27;: &#x27;{\n  &quot;place&quot;: &quot;shelf&quot;\n}&#x27;, &#x27;name&#x27;: &#x27;get_items&#x27;}, &#x27;type&#x27;: &#x27;function&#x27;}]}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">On chain end</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">[{&#x27;lc&#x27;: 1, &#x27;type&#x27;: &#x27;constructor&#x27;, &#x27;id&#x27;: [&#x27;langchain&#x27;, &#x27;schema&#x27;, &#x27;agent&#x27;, &#x27;OpenAIToolAgentAction&#x27;], &#x27;kwargs&#x27;: {&#x27;tool&#x27;: &#x27;get_items&#x27;, &#x27;tool_input&#x27;: {&#x27;place&#x27;: &#x27;shelf&#x27;}, &#x27;log&#x27;: &quot;\nInvoking: `get_items` with `{&#x27;place&#x27;: &#x27;shelf&#x27;}`\n\n\n&quot;, &#x27;message_log&#x27;: [{&#x27;lc&#x27;: 1, &#x27;type&#x27;: &#x27;constructor&#x27;, &#x27;id&#x27;: [&#x27;langchain&#x27;, &#x27;schema&#x27;, &#x27;messages&#x27;, &#x27;AIMessageChunk&#x27;], &#x27;kwargs&#x27;: {&#x27;example&#x27;: False, &#x27;content&#x27;: &#x27;&#x27;, &#x27;additional_kwargs&#x27;: {&#x27;tool_calls&#x27;: [{&#x27;index&#x27;: 0, &#x27;id&#x27;: &#x27;call_vIVtgUb9Gvmc3zAGIrshnmbh&#x27;, &#x27;function&#x27;: {&#x27;arguments&#x27;: &#x27;{\n  &quot;place&quot;: &quot;shelf&quot;\n}&#x27;, &#x27;name&#x27;: &#x27;get_items&#x27;}, &#x27;type&#x27;: &#x27;function&#x27;}]}}}], &#x27;tool_call_id&#x27;: &#x27;call_vIVtgUb9Gvmc3zAGIrshnmbh&#x27;}}]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">On chain end</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">[OpenAIToolAgentAction(tool=&#x27;get_items&#x27;, tool_input={&#x27;place&#x27;: &#x27;shelf&#x27;}, log=&quot;\nInvoking: `get_items` with `{&#x27;place&#x27;: &#x27;shelf&#x27;}`\n\n\n&quot;, message_log=[AIMessageChunk(content=&#x27;&#x27;, additional_kwargs={&#x27;tool_calls&#x27;: [{&#x27;index&#x27;: 0, &#x27;id&#x27;: &#x27;call_vIVtgUb9Gvmc3zAGIrshnmbh&#x27;, &#x27;function&#x27;: {&#x27;arguments&#x27;: &#x27;{\n  &quot;place&quot;: &quot;shelf&quot;\n}&#x27;, &#x27;name&#x27;: &#x27;get_items&#x27;}, &#x27;type&#x27;: &#x27;function&#x27;}]})], tool_call_id=&#x27;call_vIVtgUb9Gvmc3zAGIrshnmbh&#x27;)]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Tool start</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;name&#x27;: &#x27;get_items&#x27;, &#x27;description&#x27;: &#x27;get_items(place: str, callbacks: Union[List[langchain_core.callbacks.base.BaseCallbackHandler], langchain_core.callbacks.base.BaseCallbackManager, NoneType]) -&gt; str - Use this tool to look up which items are in the given place.&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">tool_llm: In| a| shelf|,| you| might| find|:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">|1|.| Books|:| A| shelf| is| commonly| used| to| store| books|.| Books| can| be| of| various| genres|,| such| as| novels|,| textbooks|,| or| reference| books|.| They| provide| knowledge|,| entertainment|,| and| can| transport| you| to| different| worlds| through| storytelling|.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">|2|.| Decor|ative| items|:| Sh|elves| often| serve| as| a| display| area| for| decorative| items| like| figur|ines|,| v|ases|,| or| sculptures|.| These| items| add| aesthetic| value| to| the| space| and| reflect| the| owner|&#x27;s| personal| taste| and| style|.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">|3|.| Storage| boxes|:| Sh|elves| can| also| be| used| to| store| various| items| in| organized| boxes|.| These| boxes| can| hold| anything| from| office| supplies|,| craft| materials|,| or| sentimental| items|.| They| help| keep| the| space| tidy| and| provide| easy| access| to| stored| belongings|.|</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Tool end</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">In a shelf, you might find:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">1. Books: A shelf is commonly used to store books. Books can be of various genres, such as novels, textbooks, or reference books. They provide knowledge, entertainment, and can transport you to different worlds through storytelling.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">2. Decorative items: Shelves often serve as a display area for decorative items like figurines, vases, or sculptures. These items add aesthetic value to the space and reflect the owner&#x27;s personal taste and style.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">3. Storage boxes: Shelves can also be used to store various items in organized boxes. These boxes can hold anything from office supplies, craft materials, or sentimental items. They help keep the space tidy and provide easy access to stored belongings.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">on chain start: </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;input&#x27;: &#x27;&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">on chain start: </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;input&#x27;: &#x27;&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">on chain start: </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;input&#x27;: &#x27;&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">on chain start: </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;input&#x27;: &#x27;&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">On chain end</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">[AIMessageChunk(content=&#x27;&#x27;, additional_kwargs={&#x27;tool_calls&#x27;: [{&#x27;index&#x27;: 0, &#x27;id&#x27;: &#x27;call_pboyZTT0587rJtujUluO2OOc&#x27;, &#x27;function&#x27;: {&#x27;arguments&#x27;: &#x27;{}&#x27;, &#x27;name&#x27;: &#x27;where_cat_is_hiding&#x27;}, &#x27;type&#x27;: &#x27;function&#x27;}]}), ToolMessage(content=&#x27;on the shelf&#x27;, additional_kwargs={&#x27;name&#x27;: &#x27;where_cat_is_hiding&#x27;}, tool_call_id=&#x27;call_pboyZTT0587rJtujUluO2OOc&#x27;), AIMessageChunk(content=&#x27;&#x27;, additional_kwargs={&#x27;tool_calls&#x27;: [{&#x27;index&#x27;: 0, &#x27;id&#x27;: &#x27;call_vIVtgUb9Gvmc3zAGIrshnmbh&#x27;, &#x27;function&#x27;: {&#x27;arguments&#x27;: &#x27;{\n  &quot;place&quot;: &quot;shelf&quot;\n}&#x27;, &#x27;name&#x27;: &#x27;get_items&#x27;}, &#x27;type&#x27;: &#x27;function&#x27;}]}), ToolMessage(content=&quot;In a shelf, you might find:\n\n1. Books: A shelf is commonly used to store books. Books can be of various genres, such as novels, textbooks, or reference books. They provide knowledge, entertainment, and can transport you to different worlds through storytelling.\n\n2. Decorative items: Shelves often serve as a display area for decorative items like figurines, vases, or sculptures. These items add aesthetic value to the space and reflect the owner&#x27;s personal taste and style.\n\n3. Storage boxes: Shelves can also be used to store various items in organized boxes. These boxes can hold anything from office supplies, craft materials, or sentimental items. They help keep the space tidy and provide easy access to stored belongings.&quot;, additional_kwargs={&#x27;name&#x27;: &#x27;get_items&#x27;}, tool_call_id=&#x27;call_vIVtgUb9Gvmc3zAGIrshnmbh&#x27;)]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">On chain end</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;agent_scratchpad&#x27;: [AIMessageChunk(content=&#x27;&#x27;, additional_kwargs={&#x27;tool_calls&#x27;: [{&#x27;index&#x27;: 0, &#x27;id&#x27;: &#x27;call_pboyZTT0587rJtujUluO2OOc&#x27;, &#x27;function&#x27;: {&#x27;arguments&#x27;: &#x27;{}&#x27;, &#x27;name&#x27;: &#x27;where_cat_is_hiding&#x27;}, &#x27;type&#x27;: &#x27;function&#x27;}]}), ToolMessage(content=&#x27;on the shelf&#x27;, additional_kwargs={&#x27;name&#x27;: &#x27;where_cat_is_hiding&#x27;}, tool_call_id=&#x27;call_pboyZTT0587rJtujUluO2OOc&#x27;), AIMessageChunk(content=&#x27;&#x27;, additional_kwargs={&#x27;tool_calls&#x27;: [{&#x27;index&#x27;: 0, &#x27;id&#x27;: &#x27;call_vIVtgUb9Gvmc3zAGIrshnmbh&#x27;, &#x27;function&#x27;: {&#x27;arguments&#x27;: &#x27;{\n  &quot;place&quot;: &quot;shelf&quot;\n}&#x27;, &#x27;name&#x27;: &#x27;get_items&#x27;}, &#x27;type&#x27;: &#x27;function&#x27;}]}), ToolMessage(content=&quot;In a shelf, you might find:\n\n1. Books: A shelf is commonly used to store books. Books can be of various genres, such as novels, textbooks, or reference books. They provide knowledge, entertainment, and can transport you to different worlds through storytelling.\n\n2. Decorative items: Shelves often serve as a display area for decorative items like figurines, vases, or sculptures. These items add aesthetic value to the space and reflect the owner&#x27;s personal taste and style.\n\n3. Storage boxes: Shelves can also be used to store various items in organized boxes. These boxes can hold anything from office supplies, craft materials, or sentimental items. They help keep the space tidy and provide easy access to stored belongings.&quot;, additional_kwargs={&#x27;name&#x27;: &#x27;get_items&#x27;}, tool_call_id=&#x27;call_vIVtgUb9Gvmc3zAGIrshnmbh&#x27;)]}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">On chain end</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;input&#x27;: &#x27;where is the cat hiding and what items can be found there?&#x27;, &#x27;intermediate_steps&#x27;: [(OpenAIToolAgentAction(tool=&#x27;where_cat_is_hiding&#x27;, tool_input={}, log=&#x27;\nInvoking: `where_cat_is_hiding` with `{}`\n\n\n&#x27;, message_log=[AIMessageChunk(content=&#x27;&#x27;, additional_kwargs={&#x27;tool_calls&#x27;: [{&#x27;index&#x27;: 0, &#x27;id&#x27;: &#x27;call_pboyZTT0587rJtujUluO2OOc&#x27;, &#x27;function&#x27;: {&#x27;arguments&#x27;: &#x27;{}&#x27;, &#x27;name&#x27;: &#x27;where_cat_is_hiding&#x27;}, &#x27;type&#x27;: &#x27;function&#x27;}]})], tool_call_id=&#x27;call_pboyZTT0587rJtujUluO2OOc&#x27;), &#x27;on the shelf&#x27;), (OpenAIToolAgentAction(tool=&#x27;get_items&#x27;, tool_input={&#x27;place&#x27;: &#x27;shelf&#x27;}, log=&quot;\nInvoking: `get_items` with `{&#x27;place&#x27;: &#x27;shelf&#x27;}`\n\n\n&quot;, message_log=[AIMessageChunk(content=&#x27;&#x27;, additional_kwargs={&#x27;tool_calls&#x27;: [{&#x27;index&#x27;: 0, &#x27;id&#x27;: &#x27;call_vIVtgUb9Gvmc3zAGIrshnmbh&#x27;, &#x27;function&#x27;: {&#x27;arguments&#x27;: &#x27;{\n  &quot;place&quot;: &quot;shelf&quot;\n}&#x27;, &#x27;name&#x27;: &#x27;get_items&#x27;}, &#x27;type&#x27;: &#x27;function&#x27;}]})], tool_call_id=&#x27;call_vIVtgUb9Gvmc3zAGIrshnmbh&#x27;), &quot;In a shelf, you might find:\n\n1. Books: A shelf is commonly used to store books. Books can be of various genres, such as novels, textbooks, or reference books. They provide knowledge, entertainment, and can transport you to different worlds through storytelling.\n\n2. Decorative items: Shelves often serve as a display area for decorative items like figurines, vases, or sculptures. These items add aesthetic value to the space and reflect the owner&#x27;s personal taste and style.\n\n3. Storage boxes: Shelves can also be used to store various items in organized boxes. These boxes can hold anything from office supplies, craft materials, or sentimental items. They help keep the space tidy and provide easy access to stored belongings.&quot;)], &#x27;agent_scratchpad&#x27;: [AIMessageChunk(content=&#x27;&#x27;, additional_kwargs={&#x27;tool_calls&#x27;: [{&#x27;index&#x27;: 0, &#x27;id&#x27;: &#x27;call_pboyZTT0587rJtujUluO2OOc&#x27;, &#x27;function&#x27;: {&#x27;arguments&#x27;: &#x27;{}&#x27;, &#x27;name&#x27;: &#x27;where_cat_is_hiding&#x27;}, &#x27;type&#x27;: &#x27;function&#x27;}]}), ToolMessage(content=&#x27;on the shelf&#x27;, additional_kwargs={&#x27;name&#x27;: &#x27;where_cat_is_hiding&#x27;}, tool_call_id=&#x27;call_pboyZTT0587rJtujUluO2OOc&#x27;), AIMessageChunk(content=&#x27;&#x27;, additional_kwargs={&#x27;tool_calls&#x27;: [{&#x27;index&#x27;: 0, &#x27;id&#x27;: &#x27;call_vIVtgUb9Gvmc3zAGIrshnmbh&#x27;, &#x27;function&#x27;: {&#x27;arguments&#x27;: &#x27;{\n  &quot;place&quot;: &quot;shelf&quot;\n}&#x27;, &#x27;name&#x27;: &#x27;get_items&#x27;}, &#x27;type&#x27;: &#x27;function&#x27;}]}), ToolMessage(content=&quot;In a shelf, you might find:\n\n1. Books: A shelf is commonly used to store books. Books can be of various genres, such as novels, textbooks, or reference books. They provide knowledge, entertainment, and can transport you to different worlds through storytelling.\n\n2. Decorative items: Shelves often serve as a display area for decorative items like figurines, vases, or sculptures. These items add aesthetic value to the space and reflect the owner&#x27;s personal taste and style.\n\n3. Storage boxes: Shelves can also be used to store various items in organized boxes. These boxes can hold anything from office supplies, craft materials, or sentimental items. They help keep the space tidy and provide easy access to stored belongings.&quot;, additional_kwargs={&#x27;name&#x27;: &#x27;get_items&#x27;}, tool_call_id=&#x27;call_vIVtgUb9Gvmc3zAGIrshnmbh&#x27;)]}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">on chain start: </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;input&#x27;: &#x27;where is the cat hiding and what items can be found there?&#x27;, &#x27;intermediate_steps&#x27;: [(OpenAIToolAgentAction(tool=&#x27;where_cat_is_hiding&#x27;, tool_input={}, log=&#x27;\nInvoking: `where_cat_is_hiding` with `{}`\n\n\n&#x27;, message_log=[AIMessageChunk(content=&#x27;&#x27;, additional_kwargs={&#x27;tool_calls&#x27;: [{&#x27;index&#x27;: 0, &#x27;id&#x27;: &#x27;call_pboyZTT0587rJtujUluO2OOc&#x27;, &#x27;function&#x27;: {&#x27;arguments&#x27;: &#x27;{}&#x27;, &#x27;name&#x27;: &#x27;where_cat_is_hiding&#x27;}, &#x27;type&#x27;: &#x27;function&#x27;}]})], tool_call_id=&#x27;call_pboyZTT0587rJtujUluO2OOc&#x27;), &#x27;on the shelf&#x27;), (OpenAIToolAgentAction(tool=&#x27;get_items&#x27;, tool_input={&#x27;place&#x27;: &#x27;shelf&#x27;}, log=&quot;\nInvoking: `get_items` with `{&#x27;place&#x27;: &#x27;shelf&#x27;}`\n\n\n&quot;, message_log=[AIMessageChunk(content=&#x27;&#x27;, additional_kwargs={&#x27;tool_calls&#x27;: [{&#x27;index&#x27;: 0, &#x27;id&#x27;: &#x27;call_vIVtgUb9Gvmc3zAGIrshnmbh&#x27;, &#x27;function&#x27;: {&#x27;arguments&#x27;: &#x27;{\n  &quot;place&quot;: &quot;shelf&quot;\n}&#x27;, &#x27;name&#x27;: &#x27;get_items&#x27;}, &#x27;type&#x27;: &#x27;function&#x27;}]})], tool_call_id=&#x27;call_vIVtgUb9Gvmc3zAGIrshnmbh&#x27;), &quot;In a shelf, you might find:\n\n1. Books: A shelf is commonly used to store books. Books can be of various genres, such as novels, textbooks, or reference books. They provide knowledge, entertainment, and can transport you to different worlds through storytelling.\n\n2. Decorative items: Shelves often serve as a display area for decorative items like figurines, vases, or sculptures. These items add aesthetic value to the space and reflect the owner&#x27;s personal taste and style.\n\n3. Storage boxes: Shelves can also be used to store various items in organized boxes. These boxes can hold anything from office supplies, craft materials, or sentimental items. They help keep the space tidy and provide easy access to stored belongings.&quot;)], &#x27;agent_scratchpad&#x27;: [AIMessageChunk(content=&#x27;&#x27;, additional_kwargs={&#x27;tool_calls&#x27;: [{&#x27;index&#x27;: 0, &#x27;id&#x27;: &#x27;call_pboyZTT0587rJtujUluO2OOc&#x27;, &#x27;function&#x27;: {&#x27;arguments&#x27;: &#x27;{}&#x27;, &#x27;name&#x27;: &#x27;where_cat_is_hiding&#x27;}, &#x27;type&#x27;: &#x27;function&#x27;}]}), ToolMessage(content=&#x27;on the shelf&#x27;, additional_kwargs={&#x27;name&#x27;: &#x27;where_cat_is_hiding&#x27;}, tool_call_id=&#x27;call_pboyZTT0587rJtujUluO2OOc&#x27;), AIMessageChunk(content=&#x27;&#x27;, additional_kwargs={&#x27;tool_calls&#x27;: [{&#x27;index&#x27;: 0, &#x27;id&#x27;: &#x27;call_vIVtgUb9Gvmc3zAGIrshnmbh&#x27;, &#x27;function&#x27;: {&#x27;arguments&#x27;: &#x27;{\n  &quot;place&quot;: &quot;shelf&quot;\n}&#x27;, &#x27;name&#x27;: &#x27;get_items&#x27;}, &#x27;type&#x27;: &#x27;function&#x27;}]}), ToolMessage(content=&quot;In a shelf, you might find:\n\n1. Books: A shelf is commonly used to store books. Books can be of various genres, such as novels, textbooks, or reference books. They provide knowledge, entertainment, and can transport you to different worlds through storytelling.\n\n2. Decorative items: Shelves often serve as a display area for decorative items like figurines, vases, or sculptures. These items add aesthetic value to the space and reflect the owner&#x27;s personal taste and style.\n\n3. Storage boxes: Shelves can also be used to store various items in organized boxes. These boxes can hold anything from office supplies, craft materials, or sentimental items. They help keep the space tidy and provide easy access to stored belongings.&quot;, additional_kwargs={&#x27;name&#x27;: &#x27;get_items&#x27;}, tool_call_id=&#x27;call_vIVtgUb9Gvmc3zAGIrshnmbh&#x27;)]}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">On chain end</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;lc&#x27;: 1, &#x27;type&#x27;: &#x27;constructor&#x27;, &#x27;id&#x27;: [&#x27;langchain&#x27;, &#x27;prompts&#x27;, &#x27;chat&#x27;, &#x27;ChatPromptValue&#x27;], &#x27;kwargs&#x27;: {&#x27;messages&#x27;: [{&#x27;lc&#x27;: 1, &#x27;type&#x27;: &#x27;constructor&#x27;, &#x27;id&#x27;: [&#x27;langchain&#x27;, &#x27;schema&#x27;, &#x27;messages&#x27;, &#x27;SystemMessage&#x27;], &#x27;kwargs&#x27;: {&#x27;content&#x27;: &#x27;You are a helpful assistant&#x27;, &#x27;additional_kwargs&#x27;: {}}}, {&#x27;lc&#x27;: 1, &#x27;type&#x27;: &#x27;constructor&#x27;, &#x27;id&#x27;: [&#x27;langchain&#x27;, &#x27;schema&#x27;, &#x27;messages&#x27;, &#x27;HumanMessage&#x27;], &#x27;kwargs&#x27;: {&#x27;content&#x27;: &#x27;where is the cat hiding and what items can be found there?&#x27;, &#x27;additional_kwargs&#x27;: {}}}, {&#x27;lc&#x27;: 1, &#x27;type&#x27;: &#x27;constructor&#x27;, &#x27;id&#x27;: [&#x27;langchain&#x27;, &#x27;schema&#x27;, &#x27;messages&#x27;, &#x27;AIMessageChunk&#x27;], &#x27;kwargs&#x27;: {&#x27;example&#x27;: False, &#x27;content&#x27;: &#x27;&#x27;, &#x27;additional_kwargs&#x27;: {&#x27;tool_calls&#x27;: [{&#x27;index&#x27;: 0, &#x27;id&#x27;: &#x27;call_pboyZTT0587rJtujUluO2OOc&#x27;, &#x27;function&#x27;: {&#x27;arguments&#x27;: &#x27;{}&#x27;, &#x27;name&#x27;: &#x27;where_cat_is_hiding&#x27;}, &#x27;type&#x27;: &#x27;function&#x27;}]}}}, {&#x27;lc&#x27;: 1, &#x27;type&#x27;: &#x27;constructor&#x27;, &#x27;id&#x27;: [&#x27;langchain&#x27;, &#x27;schema&#x27;, &#x27;messages&#x27;, &#x27;ToolMessage&#x27;], &#x27;kwargs&#x27;: {&#x27;tool_call_id&#x27;: &#x27;call_pboyZTT0587rJtujUluO2OOc&#x27;, &#x27;content&#x27;: &#x27;on the shelf&#x27;, &#x27;additional_kwargs&#x27;: {&#x27;name&#x27;: &#x27;where_cat_is_hiding&#x27;}}}, {&#x27;lc&#x27;: 1, &#x27;type&#x27;: &#x27;constructor&#x27;, &#x27;id&#x27;: [&#x27;langchain&#x27;, &#x27;schema&#x27;, &#x27;messages&#x27;, &#x27;AIMessageChunk&#x27;], &#x27;kwargs&#x27;: {&#x27;example&#x27;: False, &#x27;content&#x27;: &#x27;&#x27;, &#x27;additional_kwargs&#x27;: {&#x27;tool_calls&#x27;: [{&#x27;index&#x27;: 0, &#x27;id&#x27;: &#x27;call_vIVtgUb9Gvmc3zAGIrshnmbh&#x27;, &#x27;function&#x27;: {&#x27;arguments&#x27;: &#x27;{\n  &quot;place&quot;: &quot;shelf&quot;\n}&#x27;, &#x27;name&#x27;: &#x27;get_items&#x27;}, &#x27;type&#x27;: &#x27;function&#x27;}]}}}, {&#x27;lc&#x27;: 1, &#x27;type&#x27;: &#x27;constructor&#x27;, &#x27;id&#x27;: [&#x27;langchain&#x27;, &#x27;schema&#x27;, &#x27;messages&#x27;, &#x27;ToolMessage&#x27;], &#x27;kwargs&#x27;: {&#x27;tool_call_id&#x27;: &#x27;call_vIVtgUb9Gvmc3zAGIrshnmbh&#x27;, &#x27;content&#x27;: &quot;In a shelf, you might find:\n\n1. Books: A shelf is commonly used to store books. Books can be of various genres, such as novels, textbooks, or reference books. They provide knowledge, entertainment, and can transport you to different worlds through storytelling.\n\n2. Decorative items: Shelves often serve as a display area for decorative items like figurines, vases, or sculptures. These items add aesthetic value to the space and reflect the owner&#x27;s personal taste and style.\n\n3. Storage boxes: Shelves can also be used to store various items in organized boxes. These boxes can hold anything from office supplies, craft materials, or sentimental items. They help keep the space tidy and provide easy access to stored belongings.&quot;, &#x27;additional_kwargs&#x27;: {&#x27;name&#x27;: &#x27;get_items&#x27;}}}]}}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">agent_llm: The| cat| is| hiding| on| the| shelf|.| In| the| shelf|,| you| might| find| books|,| decorative| items|,| and| storage| boxes|.|</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">on chain start: </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">content=&#x27;The cat is hiding on the shelf. In the shelf, you might find books, decorative items, and storage boxes.&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">On chain end</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;lc&#x27;: 1, &#x27;type&#x27;: &#x27;constructor&#x27;, &#x27;id&#x27;: [&#x27;langchain&#x27;, &#x27;schema&#x27;, &#x27;agent&#x27;, &#x27;AgentFinish&#x27;], &#x27;kwargs&#x27;: {&#x27;return_values&#x27;: {&#x27;output&#x27;: &#x27;The cat is hiding on the shelf. In the shelf, you might find books, decorative items, and storage boxes.&#x27;}, &#x27;log&#x27;: &#x27;The cat is hiding on the shelf. In the shelf, you might find books, decorative items, and storage boxes.&#x27;}}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">On chain end</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">return_values={&#x27;output&#x27;: &#x27;The cat is hiding on the shelf. In the shelf, you might find books, decorative items, and storage boxes.&#x27;} log=&#x27;The cat is hiding on the shelf. In the shelf, you might find books, decorative items, and storage boxes.&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">On chain end</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;output&#x27;: &#x27;The cat is hiding on the shelf. In the shelf, you might find books, decorative items, and storage boxes.&#x27;}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div style="display:flex;flex-direction:column"><hr><h4>Help us out by providing feedback on this documentation page:</h4><div style="display:flex;gap:5px"><div style="display:flex;align-items:center;padding-top:10px;padding-bottom:10px;padding-left:22px;padding-right:22px;border:1px solid gray;border-radius:6px;gap:10px;cursor:pointer;font-size:16px;font-weight:600" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="#166534" style="width:24px;height:24px"><path stroke-linecap="round" stroke-linejoin="round" d="M6.633 10.25c.806 0 1.533-.446 2.031-1.08a9.041 9.041 0 0 1 2.861-2.4c.723-.384 1.35-.956 1.653-1.715a4.498 4.498 0 0 0 .322-1.672V2.75a.75.75 0 0 1 .75-.75 2.25 2.25 0 0 1 2.25 2.25c0 1.152-.26 2.243-.723 3.218-.266.558.107 1.282.725 1.282m0 0h3.126c1.026 0 1.945.694 2.054 1.715.045.422.068.85.068 1.285a11.95 11.95 0 0 1-2.649 7.521c-.388.482-.987.729-1.605.729H13.48c-.483 0-.964-.078-1.423-.23l-3.114-1.04a4.501 4.501 0 0 0-1.423-.23H5.904m10.598-9.75H14.25M5.904 18.5c.083.205.173.405.27.602.197.4-.078.898-.523.898h-.908c-.889 0-1.713-.518-1.972-1.368a12 12 0 0 1-.521-3.507c0-1.553.295-3.036.831-4.398C3.387 9.953 4.167 9.5 5 9.5h1.053c.472 0 .745.556.5.96a8.958 8.958 0 0 0-1.302 4.665c0 1.194.232 2.333.654 3.375Z"></path></svg></div><div style="display:flex;align-items:center;padding-top:10px;padding-bottom:10px;padding-left:22px;padding-right:22px;border:1px solid gray;border-radius:6px;gap:10px;cursor:pointer;font-size:16px;font-weight:600" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="#991b1b" style="width:24px;height:24px"><path stroke-linecap="round" stroke-linejoin="round" d="M7.498 15.25H4.372c-1.026 0-1.945-.694-2.054-1.715a12.137 12.137 0 0 1-.068-1.285c0-2.848.992-5.464 2.649-7.521C5.287 4.247 5.886 4 6.504 4h4.016a4.5 4.5 0 0 1 1.423.23l3.114 1.04a4.5 4.5 0 0 0 1.423.23h1.294M7.498 15.25c.618 0 .991.724.725 1.282A7.471 7.471 0 0 0 7.5 19.75 2.25 2.25 0 0 0 9.75 22a.75.75 0 0 0 .75-.75v-.633c0-.573.11-1.14.322-1.672.304-.76.93-1.33 1.653-1.715a9.04 9.04 0 0 0 2.86-2.4c.498-.634 1.226-1.08 2.032-1.08h.384m-10.253 1.5H9.7m8.075-9.75c.01.05.027.1.05.148.593 1.2.925 2.55.925 3.977 0 1.487-.36 2.89-.999 4.125m.023-8.25c-.076-.365.183-.75.575-.75h.908c.889 0 1.713.518 1.972 1.368.339 1.11.521 2.287.521 3.507 0 1.553-.295 3.036-.831 4.398-.306.774-1.086 1.227-1.918 1.227h-1.053c-.472 0-.745-.556-.5-.96a8.95 8.95 0 0 0 .303-.54"></path></svg></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/v0.1/docs/modules/agents/how_to/custom_agent/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Custom agent</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/v0.1/docs/modules/agents/how_to/agent_iter/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Running Agent as an Iterator</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#create-the-model" class="table-of-contents__link toc-highlight">Create the model</a></li><li><a href="#tools" class="table-of-contents__link toc-highlight">Tools</a></li><li><a href="#initialize-the-agent" class="table-of-contents__link toc-highlight">Initialize the agent</a></li><li><a href="#stream-intermediate-steps" class="table-of-contents__link toc-highlight">Stream Intermediate Steps</a><ul><li><a href="#using-messages" class="table-of-contents__link toc-highlight">Using Messages</a></li><li><a href="#using-agentactionobservation" class="table-of-contents__link toc-highlight">Using AgentAction/Observation</a></li></ul></li><li><a href="#custom-streaming-with-events" class="table-of-contents__link toc-highlight">Custom Streaming With Events</a><ul><li><a href="#stream-events-from-within-tools" class="table-of-contents__link toc-highlight">Stream Events from within Tools</a></li><li><a href="#other-aproaches" class="table-of-contents__link toc-highlight">Other aproaches</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.gg/cU2adEyC7w" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/LangChainAI" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">GitHub</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/langchain-ai/langchain" target="_blank" rel="noopener noreferrer" class="footer__link-item">Python<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/langchain-ai/langchainjs" target="_blank" rel="noopener noreferrer" class="footer__link-item">JS/TS<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://langchain.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Homepage<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://blog.langchain.dev" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.youtube.com/@LangChain" target="_blank" rel="noopener noreferrer" class="footer__link-item">YouTube<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2024 LangChain, Inc.</div></div></div></footer></div>
<script src="/v0.1/assets/js/runtime~main.1cd6ff7f.js"></script>
<script src="/v0.1/assets/js/main.524fe94c.js"></script>
</body>
</html>