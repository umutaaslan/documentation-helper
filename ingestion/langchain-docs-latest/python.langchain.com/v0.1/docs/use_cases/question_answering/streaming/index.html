<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-use_cases/question_answering/streaming" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">Streaming | ü¶úÔ∏èüîó LangChain</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://python.langchain.com/v0.1/img/brand/theme-image.png"><meta data-rh="true" name="twitter:image" content="https://python.langchain.com/v0.1/img/brand/theme-image.png"><meta data-rh="true" property="og:url" content="https://python.langchain.com/docs/tutorials/rag/"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Streaming | ü¶úÔ∏èüîó LangChain"><meta data-rh="true" name="description" content="Often in Q&amp;A applications it&#x27;s important to show users the sources that were used to generate the answer. The simplest way to do this is for the chain to return the Documents that were retrieved in each generation."><meta data-rh="true" property="og:description" content="Often in Q&amp;A applications it&#x27;s important to show users the sources that were used to generate the answer. The simplest way to do this is for the chain to return the Documents that were retrieved in each generation."><link data-rh="true" rel="icon" href="/v0.1/img/brand/favicon.png"><link data-rh="true" rel="canonical" href="https://python.langchain.com/docs/tutorials/rag/"><link data-rh="true" rel="alternate" href="https://python.langchain.com/v0.1/docs/use_cases/question_answering/streaming/" hreflang="en"><link data-rh="true" rel="alternate" href="https://python.langchain.com/v0.1/docs/use_cases/question_answering/streaming/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://VAU016LAWS-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="ü¶úÔ∏èüîó LangChain" href="/v0.1/opensearch.xml">


<script src="/v0.1/js/google_analytics.js"></script>
<script src="https://www.googletagmanager.com/gtag/js?id=G-9B66JQQH2F" async></script><link rel="stylesheet" href="/v0.1/assets/css/styles.d4021fd6.css">
<link rel="preload" href="/v0.1/assets/js/runtime~main.1cd6ff7f.js" as="script">
<link rel="preload" href="/v0.1/assets/js/main.524fe94c.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:#FF0000;color:#FFFFFF" role="banner"><div class="content_knG7 announcementBarContent_xLdY">This is documentation for LangChain v0.1, which is no longer actively maintained. Check out the docs for the <a href="https://python.langchain.com/docs/introduction">latest version here</a>.</div></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/v0.1/"><div class="navbar__logo"><img src="/v0.1/img/brand/wordmark.png" alt="ü¶úÔ∏èüîó LangChain" class="themedImage_ToTc themedImage--light_HNdA"><img src="/v0.1/img/brand/wordmark-dark.png" alt="ü¶úÔ∏èüîó LangChain" class="themedImage_ToTc themedImage--dark_i4oU"></div></a><a class="navbar__item navbar__link" href="/v0.1/docs/modules/">Components</a><a class="navbar__item navbar__link" href="/v0.1/docs/integrations/platforms/">Integrations</a><a class="navbar__item navbar__link" href="/v0.1/docs/guides/">Guides</a><a href="https://api.python.langchain.com/en/v0.1/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">API Reference<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">More</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/v0.1/docs/people/">People</a></li><li><a class="dropdown__link" href="/v0.1/docs/packages/">Versioning</a></li><li><a class="dropdown__link" href="/v0.1/docs/contributing/">Contributing</a></li><li><a class="dropdown__link" href="/v0.1/docs/templates/">Templates</a></li><li><a href="https://github.com/langchain-ai/langchain/blob/master/cookbook/README.md" target="_blank" rel="noopener noreferrer" class="dropdown__link">Cookbooks<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a class="dropdown__link" href="/v0.1/docs/additional_resources/tutorials/">Tutorials</a></li><li><a class="dropdown__link" href="/v0.1/docs/additional_resources/youtube/">YouTube</a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">v0.1</a><ul class="dropdown__menu"><li><a href="https://python.langchain.com/docs/introduction" target="_blank" rel="noopener noreferrer" class="dropdown__link">Latest<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://python.langchain.com/v0.2/docs/introduction" target="_blank" rel="noopener noreferrer" class="dropdown__link">v0.2<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a class="dropdown__link" href="/v0.1/docs/get_started/introduction/">v0.1</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">ü¶úÔ∏èüîó</a><ul class="dropdown__menu"><li><a href="https://smith.langchain.com" target="_blank" rel="noopener noreferrer" class="dropdown__link">LangSmith<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://docs.smith.langchain.com/" target="_blank" rel="noopener noreferrer" class="dropdown__link">LangSmith Docs<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://github.com/langchain-ai/langserve" target="_blank" rel="noopener noreferrer" class="dropdown__link">LangServe GitHub<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://github.com/langchain-ai/langchain/tree/master/templates" target="_blank" rel="noopener noreferrer" class="dropdown__link">Templates GitHub<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://templates.langchain.com" target="_blank" rel="noopener noreferrer" class="dropdown__link">Templates Hub<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://smith.langchain.com/hub" target="_blank" rel="noopener noreferrer" class="dropdown__link">LangChain Hub<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://js.langchain.com" target="_blank" rel="noopener noreferrer" class="dropdown__link">JS/TS Docs<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><a href="https://chat.langchain.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">üí¨<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/langchain-ai/langchain" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link" href="/v0.1/docs/get_started/introduction/">Get started</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/v0.1/docs/get_started/introduction/">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/v0.1/docs/get_started/quickstart/">Quickstart</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/v0.1/docs/get_started/installation/">Installation</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active" href="/v0.1/docs/use_cases/">Use cases</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/v0.1/docs/use_cases/question_answering/">Q&amp;A with RAG</a><button aria-label="Toggle the collapsible sidebar category &#x27;Q&amp;A with RAG&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/v0.1/docs/use_cases/question_answering/quickstart/">Quickstart</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/v0.1/docs/use_cases/question_answering/chat_history/">Add chat history</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/v0.1/docs/use_cases/question_answering/streaming/">Streaming</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/v0.1/docs/use_cases/question_answering/sources/">Returning sources</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/v0.1/docs/use_cases/question_answering/citations/">Citations</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/v0.1/docs/use_cases/question_answering/hybrid/">More</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/v0.1/docs/use_cases/extraction/">Extracting structured output</a><button aria-label="Toggle the collapsible sidebar category &#x27;Extracting structured output&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/v0.1/docs/use_cases/chatbots/">Chatbots</a><button aria-label="Toggle the collapsible sidebar category &#x27;Chatbots&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/v0.1/docs/use_cases/tool_use/">Tool use and agents</a><button aria-label="Toggle the collapsible sidebar category &#x27;Tool use and agents&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/v0.1/docs/use_cases/query_analysis/">Query analysis</a><button aria-label="Toggle the collapsible sidebar category &#x27;Query analysis&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/v0.1/docs/use_cases/sql/">Q&amp;A over SQL + CSV</a><button aria-label="Toggle the collapsible sidebar category &#x27;Q&amp;A over SQL + CSV&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/v0.1/docs/use_cases/graph/">More</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link" href="/v0.1/docs/expression_language/">Expression Language</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/v0.1/docs/expression_language/get_started/">Get started</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/v0.1/docs/expression_language/interface/">Runnable interface</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/v0.1/docs/expression_language/primitives/">Primitives</a><button aria-label="Toggle the collapsible sidebar category &#x27;Primitives&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/v0.1/docs/expression_language/why/">Advantages of LCEL</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/v0.1/docs/expression_language/streaming/">Streaming</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/v0.1/docs/expression_language/how_to/message_history/">Add message history (memory)</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/v0.1/docs/expression_language/how_to/routing/">More</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">Ecosystem</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/v0.1/docs/langsmith/">ü¶úüõ†Ô∏è LangSmith</a><button aria-label="Toggle the collapsible sidebar category &#x27;ü¶úüõ†Ô∏è LangSmith&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a href="https://langchain-ai.github.io/langgraph/" target="_blank" rel="noopener noreferrer" class="menu__link menuExternalLink_NmtK" tabindex="0">ü¶úüï∏Ô∏è LangGraph<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/v0.1/docs/langserve/">ü¶úÔ∏èüèì LangServe</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/v0.1/docs/security/">Security</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for <!-- -->LangChain<!-- --> <b>v0.1</b>, which is no longer actively maintained.</div><div class="margin-top--md">For the current stable version, see <b><a href="https://python.langchain.com/docs/tutorials/rag/" target="_blank" rel="noopener noreferrer">this version</a></b> (<!-- -->Latest<!-- -->).</div></div><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/v0.1/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/v0.1/docs/use_cases/"><span itemprop="name">Use cases</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/v0.1/docs/use_cases/question_answering/"><span itemprop="name">Q&amp;A with RAG</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Streaming</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Streaming</h1><p>Often in Q&amp;A applications it&#x27;s important to show users the sources that were used to generate the answer. The simplest way to do this is for the chain to return the Documents that were retrieved in each generation.</p><p>We&#x27;ll work off of the Q&amp;A app with sources we built over the <a href="https://lilianweng.github.io/posts/2023-06-23-agent/" target="_blank" rel="noopener noreferrer">LLM Powered Autonomous Agents</a> blog post by Lilian Weng in the <a href="/v0.1/docs/use_cases/question_answering/sources/">Returning sources</a> guide.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="setup">Setup<a href="#setup" class="hash-link" aria-label="Direct link to Setup" title="Direct link to Setup">‚Äã</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="dependencies">Dependencies<a href="#dependencies" class="hash-link" aria-label="Direct link to Dependencies" title="Direct link to Dependencies">‚Äã</a></h3><p>We&#x27;ll use an OpenAI chat model and embeddings and a Chroma vector store in this walkthrough, but everything shown here works with any <a href="/v0.1/docs/modules/model_io/chat/">ChatModel</a> or <a href="/v0.1/docs/modules/model_io/llms/">LLM</a>, <a href="/v0.1/docs/modules/data_connection/text_embedding/">Embeddings</a>, and <a href="/v0.1/docs/modules/data_connection/vectorstores/">VectorStore</a> or <a href="/v0.1/docs/modules/data_connection/retrievers/">Retriever</a>. </p><p>We&#x27;ll use the following packages:</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token operator" style="color:rgb(0, 0, 0)">%</span><span class="token plain">pip install </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">upgrade </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">quiet  langchain langchain</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">community langchainhub langchain</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">openai langchain</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">chroma bs4</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We need to set environment variable <code>OPENAI_API_KEY</code>, which can be done directly or loaded from a <code>.env</code> file like so:</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> getpass</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> os</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">os</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">environ</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;OPENAI_API_KEY&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> getpass</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">getpass</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># import dotenv</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># dotenv.load_dotenv()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="langsmith">LangSmith<a href="#langsmith" class="hash-link" aria-label="Direct link to LangSmith" title="Direct link to LangSmith">‚Äã</a></h3><p>Many of the applications you build with LangChain will contain multiple steps with multiple invocations of LLM calls. As these applications get more and more complex, it becomes crucial to be able to inspect what exactly is going on inside your chain or agent. The best way to do this is with <a href="https://smith.langchain.com" target="_blank" rel="noopener noreferrer">LangSmith</a>.</p><p>Note that LangSmith is not needed, but it is helpful. If you do want to use LangSmith, after you sign up at the link above, make sure to set your environment variables to start logging traces:</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">os</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">environ</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;LANGCHAIN_TRACING_V2&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;true&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">os</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">environ</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;LANGCHAIN_API_KEY&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> getpass</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">getpass</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="chain-with-sources">Chain with sources<a href="#chain-with-sources" class="hash-link" aria-label="Direct link to Chain with sources" title="Direct link to Chain with sources">‚Äã</a></h2><p>Here is Q&amp;A app with sources we built over the <a href="https://lilianweng.github.io/posts/2023-06-23-agent/" target="_blank" rel="noopener noreferrer">LLM Powered Autonomous Agents</a> blog post by Lilian Weng in the <a href="/v0.1/docs/use_cases/question_answering/sources/">Returning sources</a> guide:</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> bs4</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">from</span><span class="token plain"> langchain </span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> hub</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">from</span><span class="token plain"> langchain_chroma </span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> Chroma</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">from</span><span class="token plain"> langchain_community</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">document_loaders </span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> WebBaseLoader</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">from</span><span class="token plain"> langchain_core</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">output_parsers </span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> StrOutputParser</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">from</span><span class="token plain"> langchain_core</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">runnables </span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> RunnableParallel</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> RunnablePassthrough</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">from</span><span class="token plain"> langchain_openai </span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> ChatOpenAI</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> OpenAIEmbeddings</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">from</span><span class="token plain"> langchain_text_splitters </span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> RecursiveCharacterTextSplitter</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div style="padding-top:1.3rem;background:var(--prism-background-color);color:var(--prism-color);margin-top:calc(-1 * var(--ifm-leading) - 5px);margin-bottom:var(--ifm-leading);box-shadow:var(--ifm-global-shadow-lw);border-bottom-left-radius:var(--ifm-code-border-radius);border-bottom-right-radius:var(--ifm-code-border-radius)"><h4 style="padding-left:0.65rem;margin-bottom:0.45rem">API Reference:</h4><ul style="padding-bottom:1rem"><li><a href="https://api.python.langchain.com/en/latest/document_loaders/langchain_community.document_loaders.web_base.WebBaseLoader.html"><span>WebBaseLoader</span></a></li><li><a href="https://api.python.langchain.com/en/latest/output_parsers/langchain_core.output_parsers.string.StrOutputParser.html"><span>StrOutputParser</span></a></li><li><a href="https://api.python.langchain.com/en/latest/runnables/langchain_core.runnables.base.RunnableParallel.html"><span>RunnableParallel</span></a></li><li><a href="https://api.python.langchain.com/en/latest/runnables/langchain_core.runnables.passthrough.RunnablePassthrough.html"><span>RunnablePassthrough</span></a></li><li><a href="https://api.python.langchain.com/en/latest/chat_models/langchain_openai.chat_models.base.ChatOpenAI.html"><span>ChatOpenAI</span></a></li><li><a href="https://api.python.langchain.com/en/latest/embeddings/langchain_openai.embeddings.base.OpenAIEmbeddings.html"><span>OpenAIEmbeddings</span></a></li><li><a href="https://api.python.langchain.com/en/latest/character/langchain_text_splitters.character.RecursiveCharacterTextSplitter.html"><span>RecursiveCharacterTextSplitter</span></a></li></ul></div><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># Load, chunk and index the contents of the blog.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">bs_strainer </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> bs4</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">SoupStrainer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">class_</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;post-content&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;post-title&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;post-header&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">loader </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> WebBaseLoader</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    web_paths</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;https://lilianweng.github.io/posts/2023-06-23-agent/&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    bs_kwargs</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;parse_only&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> bs_strainer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docs </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> loader</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">load</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">text_splitter </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> RecursiveCharacterTextSplitter</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">chunk_size</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">1000</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> chunk_overlap</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">200</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">splits </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> text_splitter</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">split_documents</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">docs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">vectorstore </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> Chroma</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">from_documents</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">documents</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">splits</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> embedding</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">OpenAIEmbeddings</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Retrieve and generate using the relevant snippets of the blog.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">retriever </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> vectorstore</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">as_retriever</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">prompt </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> hub</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">pull</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;rlm/rag-prompt&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">llm </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> ChatOpenAI</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">model</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;gpt-3.5-turbo&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> temperature</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">format_docs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">docs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;\n\n&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">join</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">doc</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">page_content </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> doc </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> docs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">rag_chain_from_docs </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    RunnablePassthrough</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">assign</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">context</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token keyword" style="color:rgb(0, 0, 255)">lambda</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> format_docs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;context&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> prompt</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> llm</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> StrOutputParser</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">rag_chain_with_source </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> RunnableParallel</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;context&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> retriever</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;question&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> RunnablePassthrough</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">assign</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">answer</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">rag_chain_from_docs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="streaming-final-outputs">Streaming final outputs<a href="#streaming-final-outputs" class="hash-link" aria-label="Direct link to Streaming final outputs" title="Direct link to Streaming final outputs">‚Äã</a></h2><p>With LCEL it&#x27;s easy to stream final outputs:</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> chunk </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> rag_chain_with_source</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">stream</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;What is Task Decomposition&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">chunk</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-output codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-output codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;question&#x27;: &#x27;What is Task Decomposition&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;context&#x27;: [Document(page_content=&#x27;Fig. 1. Overview of a LLM-powered autonomous agent system.\nComponent One: Planning#\nA complicated task usually involves many steps. An agent needs to know what they are and plan ahead.\nTask Decomposition#\nChain of thought (CoT; Wei et al. 2022) has become a standard prompting technique for enhancing model performance on complex tasks. The model is instructed to ‚Äúthink step by step‚Äù to utilize more test-time computation to decompose hard tasks into smaller and simpler steps. CoT transforms big tasks into multiple manageable tasks and shed lights into an interpretation of the model‚Äôs thinking process.&#x27;, metadata={&#x27;source&#x27;: &#x27;https://lilianweng.github.io/posts/2023-06-23-agent/&#x27;}), Document(page_content=&#x27;Tree of Thoughts (Yao et al. 2023) extends CoT by exploring multiple reasoning possibilities at each step. It first decomposes the problem into multiple thought steps and generates multiple thoughts per step, creating a tree structure. The search process can be BFS (breadth-first search) or DFS (depth-first search) with each state evaluated by a classifier (via a prompt) or majority vote.\nTask decomposition can be done (1) by LLM with simple prompting like &quot;Steps for XYZ.\\n1.&quot;, &quot;What are the subgoals for achieving XYZ?&quot;, (2) by using task-specific instructions; e.g. &quot;Write a story outline.&quot; for writing a novel, or (3) with human inputs.&#x27;, metadata={&#x27;source&#x27;: &#x27;https://lilianweng.github.io/posts/2023-06-23-agent/&#x27;}), Document(page_content=&#x27;The AI assistant can parse user input to several tasks: [{&quot;task&quot;: task, &quot;id&quot;, task_id, &quot;dep&quot;: dependency_task_ids, &quot;args&quot;: {&quot;text&quot;: text, &quot;image&quot;: URL, &quot;audio&quot;: URL, &quot;video&quot;: URL}}]. The &quot;dep&quot; field denotes the id of the previous task which generates a new resource that the current task relies on. A special tag &quot;-task_id&quot; refers to the generated text image, audio and video in the dependency task with id as task_id. The task MUST be selected from the following options: {{ Available Task List }}. There is a logical relationship between tasks, please note their order. If the user input can\&#x27;t be parsed, you need to reply empty JSON. Here are several cases for your reference: {{ Demonstrations }}. The chat history is recorded as {{ Chat History }}. From this chat history, you can find the path of the user-mentioned resources for your task planning.&#x27;, metadata={&#x27;source&#x27;: &#x27;https://lilianweng.github.io/posts/2023-06-23-agent/&#x27;}), Document(page_content=&#x27;Fig. 11. Illustration of how HuggingGPT works. (Image source: Shen et al. 2023)\nThe system comprises of 4 stages:\n(1) Task planning: LLM works as the brain and parses the user requests into multiple tasks. There are four attributes associated with each task: task type, ID, dependencies, and arguments. They use few-shot examples to guide LLM to do task parsing and planning.\nInstruction:&#x27;, metadata={&#x27;source&#x27;: &#x27;https://lilianweng.github.io/posts/2023-06-23-agent/&#x27;})]}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27;&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27;Task&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27; decomposition&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27; is&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27; a&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27; technique&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27; used&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27; to&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27; break&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27; down&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27; complex&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27; tasks&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27; into&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27; smaller&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27; and&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27; simpler&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27; steps&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27;.&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27; It&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27; can&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27; be&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27; done&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27; through&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27; methods&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27; like&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27; Chain&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27; of&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27; Thought&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27; (&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27;Co&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27;T&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27;)&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27; or&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27; Tree&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27; of&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27; Thoughts&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27;,&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27; which&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27; involve&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27; dividing&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27; the&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27; task&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27; into&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27; manageable&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27; sub&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27;tasks&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27; and&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27; exploring&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27; multiple&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27; reasoning&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27; possibilities&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27; at&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27; each&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27; step&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27;.&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27; Task&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27; decomposition&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27; can&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27; be&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27; performed&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27; by&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27; using&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27; simple&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27; prompts&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27;,&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27; task&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27;-specific&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27; instructions&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27;,&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27; or&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27; human&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27; inputs&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27;.&#x27;}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;answer&#x27;: &#x27;&#x27;}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We can add some logic to compile our stream as it&#x27;s being returned:</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">output </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">curr_key </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token boolean">None</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> chunk </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> rag_chain_with_source</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">stream</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;What is Task Decomposition&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> key </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> chunk</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> key </span><span class="token keyword" style="color:rgb(0, 0, 255)">not</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> output</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            output</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">key</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> chunk</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">key</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">else</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            output</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">key</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">+=</span><span class="token plain"> chunk</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">key</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> key </span><span class="token operator" style="color:rgb(0, 0, 0)">!=</span><span class="token plain"> curr_key</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token keyword" style="color:rgb(0, 0, 255)">print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string-interpolation string" style="color:rgb(163, 21, 21)">f&quot;\n\n</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string-interpolation interpolation">key</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token string-interpolation string" style="color:rgb(163, 21, 21)">: </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string-interpolation interpolation">chunk</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string-interpolation interpolation">key</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token string-interpolation string" style="color:rgb(163, 21, 21)">&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> end</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> flush</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token boolean">True</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">else</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token keyword" style="color:rgb(0, 0, 255)">print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">chunk</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">key</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> end</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> flush</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token boolean">True</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        curr_key </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> key</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">output</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-output codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-output codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">question: What is Task Decomposition</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">context: [Document(page_content=&#x27;Fig. 1. Overview of a LLM-powered autonomous agent system.\nComponent One: Planning#\nA complicated task usually involves many steps. An agent needs to know what they are and plan ahead.\nTask Decomposition#\nChain of thought (CoT; Wei et al. 2022) has become a standard prompting technique for enhancing model performance on complex tasks. The model is instructed to ‚Äúthink step by step‚Äù to utilize more test-time computation to decompose hard tasks into smaller and simpler steps. CoT transforms big tasks into multiple manageable tasks and shed lights into an interpretation of the model‚Äôs thinking process.&#x27;, metadata={&#x27;source&#x27;: &#x27;https://lilianweng.github.io/posts/2023-06-23-agent/&#x27;}), Document(page_content=&#x27;Tree of Thoughts (Yao et al. 2023) extends CoT by exploring multiple reasoning possibilities at each step. It first decomposes the problem into multiple thought steps and generates multiple thoughts per step, creating a tree structure. The search process can be BFS (breadth-first search) or DFS (depth-first search) with each state evaluated by a classifier (via a prompt) or majority vote.\nTask decomposition can be done (1) by LLM with simple prompting like &quot;Steps for XYZ.\\n1.&quot;, &quot;What are the subgoals for achieving XYZ?&quot;, (2) by using task-specific instructions; e.g. &quot;Write a story outline.&quot; for writing a novel, or (3) with human inputs.&#x27;, metadata={&#x27;source&#x27;: &#x27;https://lilianweng.github.io/posts/2023-06-23-agent/&#x27;}), Document(page_content=&#x27;The AI assistant can parse user input to several tasks: [{&quot;task&quot;: task, &quot;id&quot;, task_id, &quot;dep&quot;: dependency_task_ids, &quot;args&quot;: {&quot;text&quot;: text, &quot;image&quot;: URL, &quot;audio&quot;: URL, &quot;video&quot;: URL}}]. The &quot;dep&quot; field denotes the id of the previous task which generates a new resource that the current task relies on. A special tag &quot;-task_id&quot; refers to the generated text image, audio and video in the dependency task with id as task_id. The task MUST be selected from the following options: {{ Available Task List }}. There is a logical relationship between tasks, please note their order. If the user input can\&#x27;t be parsed, you need to reply empty JSON. Here are several cases for your reference: {{ Demonstrations }}. The chat history is recorded as {{ Chat History }}. From this chat history, you can find the path of the user-mentioned resources for your task planning.&#x27;, metadata={&#x27;source&#x27;: &#x27;https://lilianweng.github.io/posts/2023-06-23-agent/&#x27;}), Document(page_content=&#x27;Fig. 11. Illustration of how HuggingGPT works. (Image source: Shen et al. 2023)\nThe system comprises of 4 stages:\n(1) Task planning: LLM works as the brain and parses the user requests into multiple tasks. There are four attributes associated with each task: task type, ID, dependencies, and arguments. They use few-shot examples to guide LLM to do task parsing and planning.\nInstruction:&#x27;, metadata={&#x27;source&#x27;: &#x27;https://lilianweng.github.io/posts/2023-06-23-agent/&#x27;})]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">answer: Task decomposition is a technique used to break down complex tasks into smaller and simpler steps. It can be done through methods like Chain of Thought (CoT) or Tree of Thoughts, which involve dividing the task into manageable subtasks and exploring multiple reasoning possibilities at each step. Task decomposition can be performed by using simple prompts, task-specific instructions, or human inputs.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-output codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-output codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;question&#x27;: &#x27;What is Task Decomposition&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> &#x27;context&#x27;: [Document(page_content=&#x27;Fig. 1. Overview of a LLM-powered autonomous agent system.\nComponent One: Planning#\nA complicated task usually involves many steps. An agent needs to know what they are and plan ahead.\nTask Decomposition#\nChain of thought (CoT; Wei et al. 2022) has become a standard prompting technique for enhancing model performance on complex tasks. The model is instructed to ‚Äúthink step by step‚Äù to utilize more test-time computation to decompose hard tasks into smaller and simpler steps. CoT transforms big tasks into multiple manageable tasks and shed lights into an interpretation of the model‚Äôs thinking process.&#x27;, metadata={&#x27;source&#x27;: &#x27;https://lilianweng.github.io/posts/2023-06-23-agent/&#x27;}),</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  Document(page_content=&#x27;Tree of Thoughts (Yao et al. 2023) extends CoT by exploring multiple reasoning possibilities at each step. It first decomposes the problem into multiple thought steps and generates multiple thoughts per step, creating a tree structure. The search process can be BFS (breadth-first search) or DFS (depth-first search) with each state evaluated by a classifier (via a prompt) or majority vote.\nTask decomposition can be done (1) by LLM with simple prompting like &quot;Steps for XYZ.\\n1.&quot;, &quot;What are the subgoals for achieving XYZ?&quot;, (2) by using task-specific instructions; e.g. &quot;Write a story outline.&quot; for writing a novel, or (3) with human inputs.&#x27;, metadata={&#x27;source&#x27;: &#x27;https://lilianweng.github.io/posts/2023-06-23-agent/&#x27;}),</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  Document(page_content=&#x27;The AI assistant can parse user input to several tasks: [{&quot;task&quot;: task, &quot;id&quot;, task_id, &quot;dep&quot;: dependency_task_ids, &quot;args&quot;: {&quot;text&quot;: text, &quot;image&quot;: URL, &quot;audio&quot;: URL, &quot;video&quot;: URL}}]. The &quot;dep&quot; field denotes the id of the previous task which generates a new resource that the current task relies on. A special tag &quot;-task_id&quot; refers to the generated text image, audio and video in the dependency task with id as task_id. The task MUST be selected from the following options: {{ Available Task List }}. There is a logical relationship between tasks, please note their order. If the user input can\&#x27;t be parsed, you need to reply empty JSON. Here are several cases for your reference: {{ Demonstrations }}. The chat history is recorded as {{ Chat History }}. From this chat history, you can find the path of the user-mentioned resources for your task planning.&#x27;, metadata={&#x27;source&#x27;: &#x27;https://lilianweng.github.io/posts/2023-06-23-agent/&#x27;}),</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  Document(page_content=&#x27;Fig. 11. Illustration of how HuggingGPT works. (Image source: Shen et al. 2023)\nThe system comprises of 4 stages:\n(1) Task planning: LLM works as the brain and parses the user requests into multiple tasks. There are four attributes associated with each task: task type, ID, dependencies, and arguments. They use few-shot examples to guide LLM to do task parsing and planning.\nInstruction:&#x27;, metadata={&#x27;source&#x27;: &#x27;https://lilianweng.github.io/posts/2023-06-23-agent/&#x27;})],</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> &#x27;answer&#x27;: &#x27;Task decomposition is a technique used to break down complex tasks into smaller and simpler steps. It can be done through methods like Chain of Thought (CoT) or Tree of Thoughts, which involve dividing the task into manageable subtasks and exploring multiple reasoning possibilities at each step. Task decomposition can be performed by using simple prompts, task-specific instructions, or human inputs.&#x27;}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="streaming-intermediate-steps">Streaming intermediate steps<a href="#streaming-intermediate-steps" class="hash-link" aria-label="Direct link to Streaming intermediate steps" title="Direct link to Streaming intermediate steps">‚Äã</a></h2><p>Suppose we want to stream not only the final outputs of the chain, but also some intermediate steps. As an example let&#x27;s take our <a href="/v0.1/docs/use_cases/question_answering/chat_history/">Chat history</a> chain. Here we reformulate the user question before passing it to the retriever. This reformulated question is not returned as part of the final output. We could modify our chain to return the new question, but for demonstration purposes we&#x27;ll leave it as is.</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">from</span><span class="token plain"> operator </span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> itemgetter</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">from</span><span class="token plain"> langchain_core</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">prompts </span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> ChatPromptTemplate</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> MessagesPlaceholder</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">from</span><span class="token plain"> langchain_core</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">tracers</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">log_stream </span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> LogEntry</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> LogStreamCallbackHandler</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">contextualize_q_system_prompt </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token triple-quoted-string string" style="color:rgb(163, 21, 21)">&quot;&quot;&quot;Given a chat history and the latest user question \</span><br></span><span class="token-line" style="color:#000000"><span class="token triple-quoted-string string" style="color:rgb(163, 21, 21)">which might reference context in the chat history, formulate a standalone question \</span><br></span><span class="token-line" style="color:#000000"><span class="token triple-quoted-string string" style="color:rgb(163, 21, 21)">which can be understood without the chat history. Do NOT answer the question, \</span><br></span><span class="token-line" style="color:#000000"><span class="token triple-quoted-string string" style="color:rgb(163, 21, 21)">just reformulate it if needed and otherwise return it as is.&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">contextualize_q_prompt </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> ChatPromptTemplate</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">from_messages</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;system&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> contextualize_q_system_prompt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        MessagesPlaceholder</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">variable_name</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;chat_history&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;human&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;{question}&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">contextualize_q_chain </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">contextualize_q_prompt </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> llm </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> StrOutputParser</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">with_config</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    tags</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;contextualize_q_chain&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">qa_system_prompt </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token triple-quoted-string string" style="color:rgb(163, 21, 21)">&quot;&quot;&quot;You are an assistant for question-answering tasks. \</span><br></span><span class="token-line" style="color:#000000"><span class="token triple-quoted-string string" style="color:rgb(163, 21, 21)">Use the following pieces of retrieved context to answer the question. \</span><br></span><span class="token-line" style="color:#000000"><span class="token triple-quoted-string string" style="color:rgb(163, 21, 21)">If you don&#x27;t know the answer, just say that you don&#x27;t know. \</span><br></span><span class="token-line" style="color:#000000"><span class="token triple-quoted-string string" style="color:rgb(163, 21, 21)">Use three sentences maximum and keep the answer concise.\</span><br></span><span class="token-line" style="color:#000000"><span class="token triple-quoted-string string" style="display:inline-block;color:rgb(163, 21, 21)"></span><br></span><span class="token-line" style="color:#000000"><span class="token triple-quoted-string string" style="color:rgb(163, 21, 21)">{context}&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">qa_prompt </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> ChatPromptTemplate</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">from_messages</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;system&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> qa_system_prompt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        MessagesPlaceholder</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">variable_name</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;chat_history&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;human&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;{question}&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">contextualized_question</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token builtin" style="color:rgb(0, 112, 193)">input</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(0, 112, 193)">dict</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(0, 112, 193)">input</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">get</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;chat_history&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> contextualize_q_chain</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">else</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(0, 112, 193)">input</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;question&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">rag_chain </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    RunnablePassthrough</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">assign</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">context</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">contextualize_q_chain </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> retriever </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> format_docs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> qa_prompt</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> llm</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div style="padding-top:1.3rem;background:var(--prism-background-color);color:var(--prism-color);margin-top:calc(-1 * var(--ifm-leading) - 5px);margin-bottom:var(--ifm-leading);box-shadow:var(--ifm-global-shadow-lw);border-bottom-left-radius:var(--ifm-code-border-radius);border-bottom-right-radius:var(--ifm-code-border-radius)"><h4 style="padding-left:0.65rem;margin-bottom:0.45rem">API Reference:</h4><ul style="padding-bottom:1rem"><li><a href="https://api.python.langchain.com/en/latest/prompts/langchain_core.prompts.chat.ChatPromptTemplate.html"><span>ChatPromptTemplate</span></a></li><li><a href="https://api.python.langchain.com/en/latest/prompts/langchain_core.prompts.chat.MessagesPlaceholder.html"><span>MessagesPlaceholder</span></a></li><li><a href="https://api.python.langchain.com/en/latest/tracers/langchain_core.tracers.log_stream.LogEntry.html"><span>LogEntry</span></a></li><li><a href="https://api.python.langchain.com/en/latest/tracers/langchain_core.tracers.log_stream.LogStreamCallbackHandler.html"><span>LogStreamCallbackHandler</span></a></li></ul></div><p>To stream intermediate steps we&#x27;ll use the <code>astream_log</code> method. This is an async method that yields JSONPatch ops that when applied in the same order as received build up the RunState:</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">from</span><span class="token plain"> typing </span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> Any</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> Dict</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> List</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> Optional</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> TypedDict</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">RunState</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">TypedDict</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token builtin" style="color:rgb(0, 112, 193)">id</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(0, 112, 193)">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:rgb(163, 21, 21)">&quot;&quot;&quot;ID of the run.&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    streamed_output</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> List</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">Any</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:rgb(163, 21, 21)">&quot;&quot;&quot;List of output chunks streamed by Runnable.stream()&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    final_output</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Optional</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">Any</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:rgb(163, 21, 21)">&quot;&quot;&quot;Final output of the run, usually the result of aggregating (`+`) streamed_output.</span><br></span><span class="token-line" style="color:#000000"><span class="token triple-quoted-string string" style="color:rgb(163, 21, 21)">    Only available after the run has finished successfully.&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    logs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Dict</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token builtin" style="color:rgb(0, 112, 193)">str</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> LogEntry</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:rgb(163, 21, 21)">&quot;&quot;&quot;Map of run names to sub-runs. If filters were supplied, this list will</span><br></span><span class="token-line" style="color:#000000"><span class="token triple-quoted-string string" style="color:rgb(163, 21, 21)">    contain only the runs that matched the filters.&quot;&quot;&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You can stream all steps (default) or include/exclude steps by name, tags or metadata. In this case we&#x27;ll only stream intermediate steps that are part of the <code>contextualize_q_chain</code> and the final output. Notice that when defining the <code>contextualize_q_chain</code> we gave it a corresponding tag, which we can now filter on. </p><p>We only show the first 20 chunks of the stream for readability:</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># Needed for running async functions in Jupyter notebook:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> nest_asyncio</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">nest_asyncio</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token builtin" style="color:rgb(0, 112, 193)">apply</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">from</span><span class="token plain"> langchain_core</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">messages </span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> HumanMessage</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">chat_history </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">question </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;What is Task Decomposition?&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ai_msg </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> rag_chain</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">invoke</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;question&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> question</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;chat_history&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> chat_history</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">chat_history</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">extend</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">HumanMessage</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">content</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">question</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> ai_msg</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">second_question </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;What are common ways of doing it?&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ct </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">async</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> jsonpatch_op </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> rag_chain</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">astream_log</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;question&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> second_question</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;chat_history&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> chat_history</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    include_tags</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;contextualize_q_chain&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">jsonpatch_op</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;\n&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;-&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">30</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;\n&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    ct </span><span class="token operator" style="color:rgb(0, 0, 0)">+=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> ct </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">break</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div style="padding-top:1.3rem;background:var(--prism-background-color);color:var(--prism-color);margin-top:calc(-1 * var(--ifm-leading) - 5px);margin-bottom:var(--ifm-leading);box-shadow:var(--ifm-global-shadow-lw);border-bottom-left-radius:var(--ifm-code-border-radius);border-bottom-right-radius:var(--ifm-code-border-radius)"><h4 style="padding-left:0.65rem;margin-bottom:0.45rem">API Reference:</h4><ul style="padding-bottom:1rem"><li><a href="https://api.python.langchain.com/en/latest/messages/langchain_core.messages.human.HumanMessage.html"><span>HumanMessage</span></a></li></ul></div><div class="language-output codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-output codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">RunLogPatch({&#x27;op&#x27;: &#x27;replace&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;path&#x27;: &#x27;&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;value&#x27;: {&#x27;final_output&#x27;: None,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;id&#x27;: &#x27;df0938b3-3ff2-451b-a233-6c882b640e4d&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;logs&#x27;: {},</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;streamed_output&#x27;: []}})</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">------------------------------</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RunLogPatch({&#x27;op&#x27;: &#x27;add&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;path&#x27;: &#x27;/logs/RunnableSequence&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;value&#x27;: {&#x27;end_time&#x27;: None,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;final_output&#x27;: None,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;id&#x27;: &#x27;2e2af851-9e1f-4260-b004-c30dea4affe9&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;metadata&#x27;: {},</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;name&#x27;: &#x27;RunnableSequence&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;start_time&#x27;: &#x27;2023-12-29T20:08:28.923&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;streamed_output&#x27;: [],</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;streamed_output_str&#x27;: [],</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;tags&#x27;: [&#x27;seq:step:1&#x27;, &#x27;contextualize_q_chain&#x27;],</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;type&#x27;: &#x27;chain&#x27;}})</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">------------------------------</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RunLogPatch({&#x27;op&#x27;: &#x27;add&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;path&#x27;: &#x27;/logs/ChatPromptTemplate&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;value&#x27;: {&#x27;end_time&#x27;: None,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;final_output&#x27;: None,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;id&#x27;: &#x27;7ad34564-337c-4362-ae7a-655d79cf0ab0&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;metadata&#x27;: {},</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;name&#x27;: &#x27;ChatPromptTemplate&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;start_time&#x27;: &#x27;2023-12-29T20:08:28.926&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;streamed_output&#x27;: [],</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;streamed_output_str&#x27;: [],</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;tags&#x27;: [&#x27;seq:step:1&#x27;, &#x27;contextualize_q_chain&#x27;],</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;type&#x27;: &#x27;prompt&#x27;}})</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">------------------------------</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RunLogPatch({&#x27;op&#x27;: &#x27;add&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;path&#x27;: &#x27;/logs/ChatPromptTemplate/final_output&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;value&#x27;: ChatPromptValue(messages=[SystemMessage(content=&#x27;Given a chat history and the latest user question which might reference context in the chat history, formulate a standalone question which can be understood without the chat history. Do NOT answer the question, just reformulate it if needed and otherwise return it as is.&#x27;), HumanMessage(content=&#x27;What is Task Decomposition?&#x27;), AIMessage(content=&#x27;Task decomposition is a technique used to break down complex tasks into smaller and more manageable subtasks. It involves dividing a task into multiple steps or subgoals, allowing an agent or model to better understand and plan for the overall task. Task decomposition can be done through various methods, such as using prompting techniques like Chain of Thought or Tree of Thoughts, task-specific instructions, or human inputs.&#x27;), HumanMessage(content=&#x27;What are common ways of doing it?&#x27;)])},</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> {&#x27;op&#x27;: &#x27;add&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;path&#x27;: &#x27;/logs/ChatPromptTemplate/end_time&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;value&#x27;: &#x27;2023-12-29T20:08:28.926&#x27;})</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">------------------------------</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RunLogPatch({&#x27;op&#x27;: &#x27;add&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;path&#x27;: &#x27;/logs/ChatOpenAI&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;value&#x27;: {&#x27;end_time&#x27;: None,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;final_output&#x27;: None,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;id&#x27;: &#x27;228792d6-1d76-4209-8d25-08c484b6df57&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;metadata&#x27;: {},</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;name&#x27;: &#x27;ChatOpenAI&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;start_time&#x27;: &#x27;2023-12-29T20:08:28.931&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;streamed_output&#x27;: [],</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;streamed_output_str&#x27;: [],</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;tags&#x27;: [&#x27;seq:step:2&#x27;, &#x27;contextualize_q_chain&#x27;],</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;type&#x27;: &#x27;llm&#x27;}})</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">------------------------------</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RunLogPatch({&#x27;op&#x27;: &#x27;add&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;path&#x27;: &#x27;/logs/StrOutputParser&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;value&#x27;: {&#x27;end_time&#x27;: None,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;final_output&#x27;: None,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;id&#x27;: &#x27;f740f235-2b14-412d-9f54-53bbc4fa8fd8&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;metadata&#x27;: {},</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;name&#x27;: &#x27;StrOutputParser&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;start_time&#x27;: &#x27;2023-12-29T20:08:29.487&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;streamed_output&#x27;: [],</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;streamed_output_str&#x27;: [],</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;tags&#x27;: [&#x27;seq:step:3&#x27;, &#x27;contextualize_q_chain&#x27;],</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;type&#x27;: &#x27;parser&#x27;}})</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">------------------------------</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RunLogPatch({&#x27;op&#x27;: &#x27;add&#x27;, &#x27;path&#x27;: &#x27;/logs/ChatOpenAI/streamed_output_str/-&#x27;, &#x27;value&#x27;: &#x27;&#x27;},</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> {&#x27;op&#x27;: &#x27;add&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;path&#x27;: &#x27;/logs/ChatOpenAI/streamed_output/-&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;value&#x27;: AIMessageChunk(content=&#x27;&#x27;)})</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">------------------------------</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RunLogPatch({&#x27;op&#x27;: &#x27;add&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;path&#x27;: &#x27;/logs/ChatOpenAI/streamed_output_str/-&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;value&#x27;: &#x27;What&#x27;},</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> {&#x27;op&#x27;: &#x27;add&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;path&#x27;: &#x27;/logs/ChatOpenAI/streamed_output/-&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;value&#x27;: AIMessageChunk(content=&#x27;What&#x27;)})</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">------------------------------</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RunLogPatch({&#x27;op&#x27;: &#x27;add&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;path&#x27;: &#x27;/logs/ChatOpenAI/streamed_output_str/-&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;value&#x27;: &#x27; are&#x27;},</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> {&#x27;op&#x27;: &#x27;add&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;path&#x27;: &#x27;/logs/ChatOpenAI/streamed_output/-&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;value&#x27;: AIMessageChunk(content=&#x27; are&#x27;)})</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">------------------------------</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RunLogPatch({&#x27;op&#x27;: &#x27;add&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;path&#x27;: &#x27;/logs/ChatOpenAI/streamed_output_str/-&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;value&#x27;: &#x27; some&#x27;},</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> {&#x27;op&#x27;: &#x27;add&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;path&#x27;: &#x27;/logs/ChatOpenAI/streamed_output/-&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;value&#x27;: AIMessageChunk(content=&#x27; some&#x27;)})</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">------------------------------</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RunLogPatch({&#x27;op&#x27;: &#x27;add&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;path&#x27;: &#x27;/logs/ChatOpenAI/streamed_output_str/-&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;value&#x27;: &#x27; commonly&#x27;},</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> {&#x27;op&#x27;: &#x27;add&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;path&#x27;: &#x27;/logs/ChatOpenAI/streamed_output/-&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;value&#x27;: AIMessageChunk(content=&#x27; commonly&#x27;)})</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">------------------------------</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RunLogPatch({&#x27;op&#x27;: &#x27;add&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;path&#x27;: &#x27;/logs/ChatOpenAI/streamed_output_str/-&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;value&#x27;: &#x27; used&#x27;},</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> {&#x27;op&#x27;: &#x27;add&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;path&#x27;: &#x27;/logs/ChatOpenAI/streamed_output/-&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;value&#x27;: AIMessageChunk(content=&#x27; used&#x27;)})</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">------------------------------</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RunLogPatch({&#x27;op&#x27;: &#x27;add&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;path&#x27;: &#x27;/logs/ChatOpenAI/streamed_output_str/-&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;value&#x27;: &#x27; methods&#x27;},</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> {&#x27;op&#x27;: &#x27;add&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;path&#x27;: &#x27;/logs/ChatOpenAI/streamed_output/-&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;value&#x27;: AIMessageChunk(content=&#x27; methods&#x27;)})</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">------------------------------</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RunLogPatch({&#x27;op&#x27;: &#x27;add&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;path&#x27;: &#x27;/logs/ChatOpenAI/streamed_output_str/-&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;value&#x27;: &#x27; or&#x27;},</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> {&#x27;op&#x27;: &#x27;add&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;path&#x27;: &#x27;/logs/ChatOpenAI/streamed_output/-&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;value&#x27;: AIMessageChunk(content=&#x27; or&#x27;)})</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">------------------------------</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RunLogPatch({&#x27;op&#x27;: &#x27;add&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;path&#x27;: &#x27;/logs/ChatOpenAI/streamed_output_str/-&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;value&#x27;: &#x27; approaches&#x27;},</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> {&#x27;op&#x27;: &#x27;add&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;path&#x27;: &#x27;/logs/ChatOpenAI/streamed_output/-&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;value&#x27;: AIMessageChunk(content=&#x27; approaches&#x27;)})</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">------------------------------</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RunLogPatch({&#x27;op&#x27;: &#x27;add&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;path&#x27;: &#x27;/logs/ChatOpenAI/streamed_output_str/-&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;value&#x27;: &#x27; for&#x27;},</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> {&#x27;op&#x27;: &#x27;add&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;path&#x27;: &#x27;/logs/ChatOpenAI/streamed_output/-&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;value&#x27;: AIMessageChunk(content=&#x27; for&#x27;)})</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">------------------------------</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RunLogPatch({&#x27;op&#x27;: &#x27;add&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;path&#x27;: &#x27;/logs/ChatOpenAI/streamed_output_str/-&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;value&#x27;: &#x27; task&#x27;},</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> {&#x27;op&#x27;: &#x27;add&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;path&#x27;: &#x27;/logs/ChatOpenAI/streamed_output/-&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;value&#x27;: AIMessageChunk(content=&#x27; task&#x27;)})</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">------------------------------</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RunLogPatch({&#x27;op&#x27;: &#x27;add&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;path&#x27;: &#x27;/logs/ChatOpenAI/streamed_output_str/-&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;value&#x27;: &#x27; decomposition&#x27;},</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> {&#x27;op&#x27;: &#x27;add&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;path&#x27;: &#x27;/logs/ChatOpenAI/streamed_output/-&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;value&#x27;: AIMessageChunk(content=&#x27; decomposition&#x27;)})</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">------------------------------</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RunLogPatch({&#x27;op&#x27;: &#x27;add&#x27;, &#x27;path&#x27;: &#x27;/logs/ChatOpenAI/streamed_output_str/-&#x27;, &#x27;value&#x27;: &#x27;?&#x27;},</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> {&#x27;op&#x27;: &#x27;add&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;path&#x27;: &#x27;/logs/ChatOpenAI/streamed_output/-&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;value&#x27;: AIMessageChunk(content=&#x27;?&#x27;)})</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">------------------------------</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RunLogPatch({&#x27;op&#x27;: &#x27;add&#x27;, &#x27;path&#x27;: &#x27;/logs/ChatOpenAI/streamed_output_str/-&#x27;, &#x27;value&#x27;: &#x27;&#x27;},</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> {&#x27;op&#x27;: &#x27;add&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;path&#x27;: &#x27;/logs/ChatOpenAI/streamed_output/-&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;value&#x27;: AIMessageChunk(content=&#x27;&#x27;)})</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">------------------------------</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RunLogPatch({&#x27;op&#x27;: &#x27;add&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;path&#x27;: &#x27;/logs/ChatOpenAI/final_output&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;value&#x27;: {&#x27;generations&#x27;: [[{&#x27;generation_info&#x27;: {&#x27;finish_reason&#x27;: &#x27;stop&#x27;},</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                              &#x27;message&#x27;: AIMessageChunk(content=&#x27;What are some commonly used methods or approaches for task decomposition?&#x27;),</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                              &#x27;text&#x27;: &#x27;What are some commonly used methods or &#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                                      &#x27;approaches for task decomposition?&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                              &#x27;type&#x27;: &#x27;ChatGenerationChunk&#x27;}]],</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;llm_output&#x27;: None,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;run&#x27;: None}},</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> {&#x27;op&#x27;: &#x27;add&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;path&#x27;: &#x27;/logs/ChatOpenAI/end_time&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;value&#x27;: &#x27;2023-12-29T20:08:29.688&#x27;})</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">------------------------------</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If we wanted to get our retrieved docs, we could filter on name &quot;Retriever&quot;:</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">ct </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">async</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> jsonpatch_op </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> rag_chain</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">astream_log</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;question&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> second_question</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;chat_history&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> chat_history</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    include_names</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Retriever&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    with_streamed_output_list</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token boolean">False</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">jsonpatch_op</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;\n&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;-&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">30</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;\n&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    ct </span><span class="token operator" style="color:rgb(0, 0, 0)">+=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> ct </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">break</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-output codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-output codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">RunLogPatch({&#x27;op&#x27;: &#x27;replace&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;path&#x27;: &#x27;&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;value&#x27;: {&#x27;final_output&#x27;: None,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;id&#x27;: &#x27;9d122c72-378c-41f8-96fe-3fd9a214e9bc&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;logs&#x27;: {},</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;streamed_output&#x27;: []}})</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">------------------------------</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RunLogPatch({&#x27;op&#x27;: &#x27;add&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;path&#x27;: &#x27;/logs/Retriever&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;value&#x27;: {&#x27;end_time&#x27;: None,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;final_output&#x27;: None,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;id&#x27;: &#x27;c83481fb-7ca3-4125-9280-96da0c14eee9&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;metadata&#x27;: {},</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;name&#x27;: &#x27;Retriever&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;start_time&#x27;: &#x27;2023-12-29T20:10:13.794&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;streamed_output&#x27;: [],</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;streamed_output_str&#x27;: [],</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;tags&#x27;: [&#x27;seq:step:2&#x27;, &#x27;Chroma&#x27;, &#x27;OpenAIEmbeddings&#x27;],</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            &#x27;type&#x27;: &#x27;retriever&#x27;}})</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">------------------------------</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RunLogPatch({&#x27;op&#x27;: &#x27;add&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;path&#x27;: &#x27;/logs/Retriever/final_output&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;value&#x27;: {&#x27;documents&#x27;: [Document(page_content=&#x27;Tree of Thoughts (Yao et al. 2023) extends CoT by exploring multiple reasoning possibilities at each step. It first decomposes the problem into multiple thought steps and generates multiple thoughts per step, creating a tree structure. The search process can be BFS (breadth-first search) or DFS (depth-first search) with each state evaluated by a classifier (via a prompt) or majority vote.\nTask decomposition can be done (1) by LLM with simple prompting like &quot;Steps for XYZ.\\n1.&quot;, &quot;What are the subgoals for achieving XYZ?&quot;, (2) by using task-specific instructions; e.g. &quot;Write a story outline.&quot; for writing a novel, or (3) with human inputs.&#x27;, metadata={&#x27;source&#x27;: &#x27;https://lilianweng.github.io/posts/2023-06-23-agent/&#x27;}),</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                          Document(page_content=&#x27;Fig. 1. Overview of a LLM-powered autonomous agent system.\nComponent One: Planning#\nA complicated task usually involves many steps. An agent needs to know what they are and plan ahead.\nTask Decomposition#\nChain of thought (CoT; Wei et al. 2022) has become a standard prompting technique for enhancing model performance on complex tasks. The model is instructed to ‚Äúthink step by step‚Äù to utilize more test-time computation to decompose hard tasks into smaller and simpler steps. CoT transforms big tasks into multiple manageable tasks and shed lights into an interpretation of the model‚Äôs thinking process.&#x27;, metadata={&#x27;source&#x27;: &#x27;https://lilianweng.github.io/posts/2023-06-23-agent/&#x27;}),</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                          Document(page_content=&#x27;Resources:\n1. Internet access for searches and information gathering.\n2. Long Term memory management.\n3. GPT-3.5 powered Agents for delegation of simple tasks.\n4. File output.\n\nPerformance Evaluation:\n1. Continuously review and analyze your actions to ensure you are performing to the best of your abilities.\n2. Constructively self-criticize your big-picture behavior constantly.\n3. Reflect on past decisions and strategies to refine your approach.\n4. Every command has a cost, so be smart and efficient. Aim to complete tasks in the least number of steps.&#x27;, metadata={&#x27;source&#x27;: &#x27;https://lilianweng.github.io/posts/2023-06-23-agent/&#x27;}),</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                          Document(page_content=&#x27;Fig. 9. Comparison of MIPS algorithms, measured in recall@10. (Image source: Google Blog, 2020)\nCheck more MIPS algorithms and performance comparison in ann-benchmarks.com.\nComponent Three: Tool Use#\nTool use is a remarkable and distinguishing characteristic of human beings. We create, modify and utilize external objects to do things that go beyond our physical and cognitive limits. Equipping LLMs with external tools can significantly extend the model capabilities.&#x27;, metadata={&#x27;source&#x27;: &#x27;https://lilianweng.github.io/posts/2023-06-23-agent/&#x27;})]}},</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> {&#x27;op&#x27;: &#x27;add&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;path&#x27;: &#x27;/logs/Retriever/end_time&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;value&#x27;: &#x27;2023-12-29T20:10:14.234&#x27;})</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">------------------------------</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RunLogPatch({&#x27;op&#x27;: &#x27;replace&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;path&#x27;: &#x27;/final_output&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;value&#x27;: AIMessageChunk(content=&#x27;&#x27;)})</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">------------------------------</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RunLogPatch({&#x27;op&#x27;: &#x27;replace&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;path&#x27;: &#x27;/final_output&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;value&#x27;: AIMessageChunk(content=&#x27;Common&#x27;)})</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">------------------------------</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RunLogPatch({&#x27;op&#x27;: &#x27;replace&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;path&#x27;: &#x27;/final_output&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;value&#x27;: AIMessageChunk(content=&#x27;Common ways&#x27;)})</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">------------------------------</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RunLogPatch({&#x27;op&#x27;: &#x27;replace&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;path&#x27;: &#x27;/final_output&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;value&#x27;: AIMessageChunk(content=&#x27;Common ways of&#x27;)})</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">------------------------------</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RunLogPatch({&#x27;op&#x27;: &#x27;replace&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;path&#x27;: &#x27;/final_output&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;value&#x27;: AIMessageChunk(content=&#x27;Common ways of task&#x27;)})</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">------------------------------</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RunLogPatch({&#x27;op&#x27;: &#x27;replace&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;path&#x27;: &#x27;/final_output&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;value&#x27;: AIMessageChunk(content=&#x27;Common ways of task decomposition&#x27;)})</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">------------------------------</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RunLogPatch({&#x27;op&#x27;: &#x27;replace&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;path&#x27;: &#x27;/final_output&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;value&#x27;: AIMessageChunk(content=&#x27;Common ways of task decomposition include&#x27;)})</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">------------------------------</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RunLogPatch({&#x27;op&#x27;: &#x27;replace&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;path&#x27;: &#x27;/final_output&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;value&#x27;: AIMessageChunk(content=&#x27;Common ways of task decomposition include:\n&#x27;)})</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">------------------------------</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RunLogPatch({&#x27;op&#x27;: &#x27;replace&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;path&#x27;: &#x27;/final_output&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;value&#x27;: AIMessageChunk(content=&#x27;Common ways of task decomposition include:\n1&#x27;)})</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">------------------------------</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RunLogPatch({&#x27;op&#x27;: &#x27;replace&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;path&#x27;: &#x27;/final_output&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;value&#x27;: AIMessageChunk(content=&#x27;Common ways of task decomposition include:\n1.&#x27;)})</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">------------------------------</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RunLogPatch({&#x27;op&#x27;: &#x27;replace&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;path&#x27;: &#x27;/final_output&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;value&#x27;: AIMessageChunk(content=&#x27;Common ways of task decomposition include:\n1. Using&#x27;)})</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">------------------------------</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RunLogPatch({&#x27;op&#x27;: &#x27;replace&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;path&#x27;: &#x27;/final_output&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;value&#x27;: AIMessageChunk(content=&#x27;Common ways of task decomposition include:\n1. Using prompting&#x27;)})</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">------------------------------</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RunLogPatch({&#x27;op&#x27;: &#x27;replace&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;path&#x27;: &#x27;/final_output&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;value&#x27;: AIMessageChunk(content=&#x27;Common ways of task decomposition include:\n1. Using prompting techniques&#x27;)})</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">------------------------------</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RunLogPatch({&#x27;op&#x27;: &#x27;replace&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;path&#x27;: &#x27;/final_output&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;value&#x27;: AIMessageChunk(content=&#x27;Common ways of task decomposition include:\n1. Using prompting techniques like&#x27;)})</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">------------------------------</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RunLogPatch({&#x27;op&#x27;: &#x27;replace&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;path&#x27;: &#x27;/final_output&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;value&#x27;: AIMessageChunk(content=&#x27;Common ways of task decomposition include:\n1. Using prompting techniques like Chain&#x27;)})</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">------------------------------</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RunLogPatch({&#x27;op&#x27;: &#x27;replace&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;path&#x27;: &#x27;/final_output&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;value&#x27;: AIMessageChunk(content=&#x27;Common ways of task decomposition include:\n1. Using prompting techniques like Chain of&#x27;)})</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">------------------------------</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RunLogPatch({&#x27;op&#x27;: &#x27;replace&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;path&#x27;: &#x27;/final_output&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;value&#x27;: AIMessageChunk(content=&#x27;Common ways of task decomposition include:\n1. Using prompting techniques like Chain of Thought&#x27;)})</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">------------------------------</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RunLogPatch({&#x27;op&#x27;: &#x27;replace&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;path&#x27;: &#x27;/final_output&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  &#x27;value&#x27;: AIMessageChunk(content=&#x27;Common ways of task decomposition include:\n1. Using prompting techniques like Chain of Thought (&#x27;)})</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">------------------------------</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>For more on how to stream intermediate steps check out the <a href="/v0.1/docs/expression_language/interface/#async-stream-intermediate-steps">LCEL Interface</a> docs.</p></div><div style="display:flex;flex-direction:column"><hr><h4>Help us out by providing feedback on this documentation page:</h4><div style="display:flex;gap:5px"><div style="display:flex;align-items:center;padding-top:10px;padding-bottom:10px;padding-left:22px;padding-right:22px;border:1px solid gray;border-radius:6px;gap:10px;cursor:pointer;font-size:16px;font-weight:600" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="#166534" style="width:24px;height:24px"><path stroke-linecap="round" stroke-linejoin="round" d="M6.633 10.25c.806 0 1.533-.446 2.031-1.08a9.041 9.041 0 0 1 2.861-2.4c.723-.384 1.35-.956 1.653-1.715a4.498 4.498 0 0 0 .322-1.672V2.75a.75.75 0 0 1 .75-.75 2.25 2.25 0 0 1 2.25 2.25c0 1.152-.26 2.243-.723 3.218-.266.558.107 1.282.725 1.282m0 0h3.126c1.026 0 1.945.694 2.054 1.715.045.422.068.85.068 1.285a11.95 11.95 0 0 1-2.649 7.521c-.388.482-.987.729-1.605.729H13.48c-.483 0-.964-.078-1.423-.23l-3.114-1.04a4.501 4.501 0 0 0-1.423-.23H5.904m10.598-9.75H14.25M5.904 18.5c.083.205.173.405.27.602.197.4-.078.898-.523.898h-.908c-.889 0-1.713-.518-1.972-1.368a12 12 0 0 1-.521-3.507c0-1.553.295-3.036.831-4.398C3.387 9.953 4.167 9.5 5 9.5h1.053c.472 0 .745.556.5.96a8.958 8.958 0 0 0-1.302 4.665c0 1.194.232 2.333.654 3.375Z"></path></svg></div><div style="display:flex;align-items:center;padding-top:10px;padding-bottom:10px;padding-left:22px;padding-right:22px;border:1px solid gray;border-radius:6px;gap:10px;cursor:pointer;font-size:16px;font-weight:600" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="#991b1b" style="width:24px;height:24px"><path stroke-linecap="round" stroke-linejoin="round" d="M7.498 15.25H4.372c-1.026 0-1.945-.694-2.054-1.715a12.137 12.137 0 0 1-.068-1.285c0-2.848.992-5.464 2.649-7.521C5.287 4.247 5.886 4 6.504 4h4.016a4.5 4.5 0 0 1 1.423.23l3.114 1.04a4.5 4.5 0 0 0 1.423.23h1.294M7.498 15.25c.618 0 .991.724.725 1.282A7.471 7.471 0 0 0 7.5 19.75 2.25 2.25 0 0 0 9.75 22a.75.75 0 0 0 .75-.75v-.633c0-.573.11-1.14.322-1.672.304-.76.93-1.33 1.653-1.715a9.04 9.04 0 0 0 2.86-2.4c.498-.634 1.226-1.08 2.032-1.08h.384m-10.253 1.5H9.7m8.075-9.75c.01.05.027.1.05.148.593 1.2.925 2.55.925 3.977 0 1.487-.36 2.89-.999 4.125m.023-8.25c-.076-.365.183-.75.575-.75h.908c.889 0 1.713.518 1.972 1.368.339 1.11.521 2.287.521 3.507 0 1.553-.295 3.036-.831 4.398-.306.774-1.086 1.227-1.918 1.227h-1.053c-.472 0-.745-.556-.5-.96a8.95 8.95 0 0 0 .303-.54"></path></svg></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/v0.1/docs/use_cases/question_answering/chat_history/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Add chat history</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/v0.1/docs/use_cases/question_answering/sources/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Returning sources</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#setup" class="table-of-contents__link toc-highlight">Setup</a><ul><li><a href="#dependencies" class="table-of-contents__link toc-highlight">Dependencies</a></li><li><a href="#langsmith" class="table-of-contents__link toc-highlight">LangSmith</a></li></ul></li><li><a href="#chain-with-sources" class="table-of-contents__link toc-highlight">Chain with sources</a></li><li><a href="#streaming-final-outputs" class="table-of-contents__link toc-highlight">Streaming final outputs</a></li><li><a href="#streaming-intermediate-steps" class="table-of-contents__link toc-highlight">Streaming intermediate steps</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.gg/cU2adEyC7w" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/LangChainAI" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">GitHub</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/langchain-ai/langchain" target="_blank" rel="noopener noreferrer" class="footer__link-item">Python<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/langchain-ai/langchainjs" target="_blank" rel="noopener noreferrer" class="footer__link-item">JS/TS<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://langchain.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Homepage<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://blog.langchain.dev" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.youtube.com/@LangChain" target="_blank" rel="noopener noreferrer" class="footer__link-item">YouTube<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2024 LangChain, Inc.</div></div></div></footer></div>
<script src="/v0.1/assets/js/runtime~main.1cd6ff7f.js"></script>
<script src="/v0.1/assets/js/main.524fe94c.js"></script>
</body>
</html>